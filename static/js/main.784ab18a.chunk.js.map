{"version":3,"sources":["common/components/NarrativeList/NarrativeList.module.scss","features/layout/TopBar.module.scss","features/collections/Collections.module.scss","features/collections/data_products/TaxaCount.module.scss","app/App.module.scss","common/components/Card.module.scss","features/layout/LeftNavBar.module.scss","common/components/Select.module.scss","features/profile/Profile.module.scss","common/components/Button.module.scss","common/components/Dropdown.module.scss","common/hooks.ts","features/layout/layoutSlice.ts","common/api/utils/kbaseBaseQuery.ts","common/api/index.ts","common/api/utils/serviceHelpers.ts","common/utils/stringUtils.ts","common/api/authService.ts","common/cookie.ts","features/auth/authSlice.ts","common/api/userProfileApi.ts","features/profile/profileSlice.ts","common/components/Button.tsx","common/components/Select.tsx","common/components/Dropdown.tsx","common/api/utils/parseError.ts","features/auth/Auth.tsx","features/count/countSlice.ts","features/count/Counter.tsx","features/legacy/Legacy.tsx","features/navigator/Navigator.tsx","features/layout/PageNotFound.tsx","common/components/NarrativeList/NarrativeItemDropdown.tsx","common/components/NarrativeList/NarrativeViewItem.tsx","common/components/NarrativeList/NarrativeList.tsx","features/profile/Profile.tsx","common/api/collectionsApi.ts","common/components/Card.tsx","features/collections/data_products/TaxaCount.tsx","features/collections/DataProduct.tsx","features/collections/CollectionDetail.tsx","features/collections/CollectionsList.tsx","features/collections/Collections.tsx","app/Routes.tsx","features/layout/LeftNavBar.tsx","common/assets/logo/46_square.png","features/layout/TopBar.tsx","features/layout/ErrorPage.tsx","app/App.tsx","features/icons/common.ts","common/api/narrativeMethodStore.ts","features/icons/iconSlice.ts","app/store.ts","reportWebVitals.ts","index.tsx"],"names":["module","exports","useAppDispatch","useDispatch","useAppSelector","useSelector","initialState","pageTitle","document","title","environment","pageSlice","createSlice","name","reducers","setPageTitle","state","action","payload","setEnvironment","actions","usePageTitle","dispatch","useEffect","consumedServices","getServiceUrl","async","release","baseQueryAPI","serviceStatusQuery","k","Error","getConsumedService","endpoints","serviceStatus","wizardQueryArgs","module_name","version","statusQuery","initiate","subscribe","forceRefetch","getState","wizardResult","select","isError","error","serviceUrl","data","url","unsubscribe","ENV","process","baseUrl","baseApi","createApi","reducerPath","baseQuery","fetchBaseQueryArgs","modifiedArgs","prepareHeaders","headers","api","token","auth","set","rawBaseQuery","fetchBaseQuery","kbQuery","kbQueryArgs","extraOptions","apiType","fetchArgs","URL","service","reduce","part","endsWith","startsWith","slice","toString","undefined","reqId","Math","random","method","body","id","params","request","response","status","obj","every","isJsonRpcError","result","kbaseBaseQuery","jsonRpcService","queryArgs","httpService","snakeCaseToHumanReadable","str","replace","toUpperCase","uriEncodeTemplateTag","strings","values","output","stringsArr","length","shift","value","valueSafe","includes","String","encodeURIComponent","authService","authApi","injectEndpoints","builder","authFromToken","query","Authorization","revokeToken","mutation","tokenId","encode","getCookie","cookie","split","map","kv","trim","find","_v","setCookie","options","expires","path","domain","secure","SameSite","cookieString","toUTCString","useCookie","setValue","useState","interval","setInterval","cookieVal","clearInterval","funcs","useMemo","clear","args","Date","clearCookie","authSlice","initialized","setAuth","normToken","normalizeToken","username","tokenInfo","extraReducers","addMatcher","matchFulfilled","meta","arg","originalArgs","authUsername","authToken","authInitialized","useTryAuthFromToken","currentToken","tokenQuery","useQuery","skip","isSuccess","user","t","fallback","userProfile","userProfileApi","enhanceEndpoints","addTagTypes","userProfileStatus","getUserProfile","usernames","keepUnusedDataFor","providesTags","type","setUserProfile","profile","invalidatesTags","loggedInProfile","profileSlice","setLoggedInProfile","profileRealname","realname","Button","props","className","classes","button","join","Select","defaultHasIcons","doesHaveIcons","hasIcons","setHasIcons","isFunc","classNames","horizontalMenuAlign","push","handleChange","callOnChange","handleChangeFactory","onChange","commonProps","classNamePrefix","components","formatOptionLabel","option_content","option_content_icon","icon","label","isClearable","clearable","isDisabled","disabled","isMulti","multiple","loadOptions","newOpts","inputValue","defaultOptions","opts","some","optionOrGroup","DropdownIndicator","Dropdown","indicator","children","parseError","message","code","JSON","stringify","Auth","LogoutForm","AuthForm","UserRealNameChanger","tokenString","setTokenString","authFromTokenQuery","authFromTokenResult","useLazyQuery","placeholder","e","target","onClick","alert","style","color","revokeTokenMutation","revokeTokenResult","useMutation","s","profileParams","updateProfile","updateProfileResult","nameText","setNameText","maxWidth","isLoading","faSpinner","spin","onInput","currentTarget","newProfile","parse","changeName","faCheck","faX","countSlice","count","increment","countStatus","Counter","currentCount","Count","Legacy","location","useLocation","navigate","useNavigate","legacyContentRef","useRef","legacyTitle","setLegacyTitle","expectedLegacyPath","getLegacyPart","pathname","search","hash","legacyPath","setLegacyPath","recievedToken","setReceivedToken","useMessageListener","d","isRouteMessage","original","isTitleMessage","isAuthMessage","current","contentWindow","postMessage","source","display","width","height","flexFlow","frameBorder","src","formatLegacyUrl","ref","legacyRegex","RegExp","match","handler","wrappedHandler","ev","window","addEventListener","removeEventListener","messageGuard","payloadGuard","recieved","Navigator","PageNotFound","NarrativeItemDropdown","onVersionSelect","selectedVersion","setSelectedVersion","versions","Array","fill","_","n","reverse","item","marginLeft","dropdown_wrapper","version_dropdown","handleDropdownChange","event","faCaretDown","NarrativeViewItem","showVersionDropdown","onSelectItem","onUpaChange","active","idx","timeElapsed","timeago","timestamp","access_group","obj_id","handleSelectItem","narrative_item_outer","narrative_item_inner","narrative_item_text","narrative_title","handleVersionSelect","narrative_item_details","creator","NarrativeList","selectedIdx","setSelectedIdx","items","upa","itemsRemaining","hasMoreItems","loading","onLoadMoreItems","list_footer","faCog","marginRight","link_action","hasMoreButton","narrative_list_loading_outer","narrative_list_loading_inner","ProfileNarrativesMessage","yours","ProfileResume","NarrativesView","narratives","ProfileInfobox","ProfileView","Profile","narrativesLink","profileLink","viewMine","viewNarratives","to","ProfileWrapper","usernameRequested","useParams","usernameAuthed","usernameNotSpecified","viewUsername","profileQueryArgs","profileQuery","refetchOnMountOrArgChange","console","whoseProfile","collectionsService","collectionsApi","collectionsStatus","listCollections","getCollection","saveCollection","ver_tag","collection","activateVersion","either_ver","ver_num","listTaxaCountRanks","collection_id","load_ver_override","getTaxaCountRank","rank","Card","subtitle","image","linkTo","selected","rootDiv","clickableRole","handleClick","useCallback","c","clickableProps","role","tabIndex","onKeyDown","key","click","CardList","Children","child","TaxaCount","ranksParams","ranksQuery","setRank","rankOptions","countsParams","countsQuery","counts","max","opt","round","DataProduct","dataProduct","product","CollectionDetail","selectedDP","setSelectedDP","matchingDP","data_products","dp","styles","icon_url","alt","CollectionsList","collections","detailLink","Collections","element","Authed","preLoginPath","HashRouteRedirect","Routes","LeftNavBar","nav_list","NavItem","desc","faCompass","faUsers","faBook","faSearch","faSuitcase","faIdCard","faBullhorn","faExclamation","faBoxesStacked","itemClasses","nav_item","nav_icon","nav_desc","TopBar","topbar","topbar_item","HamburgerMenu","stretch","PageTitle","Enviroment","LoginMenu","login_menu","login_menu_username","faUser","faSignOutAlt","login_menu_button","login_menu_icon","faSquare","faSortDown","hamburger_menu","origin","faFile","faPlus","faServer","faInfo","faEnvelope","faQuestion","href","hamburger_menu_icon","faBars","layout","page_title","env","ci","faFlask","unknown","faQuestionCircle","appdev","faWrench","txt","ErrorPage","resetErrorBoundary","useInitApp","cookieToken","setCookieToken","clearCookieToken","isFetching","useTokenCookie","profileUser","useLoggedInProfileUser","App","basename","container","site_content","left_navbar","page_content","FallbackComponent","typeIconInfos","assemblyinput","assembly","faAlignJustify","chromatographymatrix","faTable","faListUl","contigset","domainalignment","faSliders","estimatekresult","faChartArea","expressionmatrix","faTableCells","expressionsample","faGaugeHigh","expressionseries","fba","fbamodel","featureclusters","faTableList","featureset","functionalmatrix","genome","genomeannotation","genomecomparison","genomeset","heatmap","media","metagenome","network","faCodeFork","pairedendlibrary","pangenome","faBullseye","phenotypeset","phenotypesimulationset","proteomecomparison","faArrowsLeftRight","readsset","referenceassembly","singleendlibrary","taxonomicmatrix","taxon","tree","narrativeMethodStore","narrativeMethodStoreApi","narrativeMethodStoreStatus","getMethodBriefInfo","AppTag","isAppTag","appTag","appIconCache","beta","dev","defaultApp","faCube","defaultType","loadingIcon","iconSlice","appIds","ids","appTags","i","appId","iconPath","createStore","additionalOptions","configureStore","devTools","reducer","icons","middleware","getDefaultMiddleware","concat","store","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.784ab18a.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"narrative_item_outer\":\"NarrativeList_narrative_item_outer__3XkM1\",\"active\":\"NarrativeList_active__2G5K3\",\"dropdown_wrapper\":\"NarrativeList_dropdown_wrapper__2_oyM\",\"narrative_list_loading_outer\":\"NarrativeList_narrative_list_loading_outer__zqT8m\",\"narrative_list_loading_inner\":\"NarrativeList_narrative_list_loading_inner__3N79j\",\"list_footer\":\"NarrativeList_list_footer__2Ggnp\",\"link_action\":\"NarrativeList_link_action__2VmhV\",\"narrative_item_inner\":\"NarrativeList_narrative_item_inner__23b-O\",\"narrative_item\":\"NarrativeList_narrative_item__KaFOE\",\"narrative_item_text\":\"NarrativeList_narrative_item_text__2A5DR\",\"narrative_item_details\":\"NarrativeList_narrative_item_details__1z0Jn\",\"version_dropdown\":\"NarrativeList_version_dropdown__lMW5h\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"topbar\":\"TopBar_topbar__3xoma\",\"topbar_item\":\"TopBar_topbar_item__20292\",\"stretch\":\"TopBar_stretch__5Y5fJ\",\"hamburger_menu\":\"TopBar_hamburger_menu__1Nc7c\",\"hamburger_menu_icon\":\"TopBar_hamburger_menu_icon__3ZgFI\",\"page_title\":\"TopBar_page_title__1OjqW\",\"environment\":\"TopBar_environment__Lx09_\",\"login_menu\":\"TopBar_login_menu__agXq7\",\"login_menu_username\":\"TopBar_login_menu_username__2AgT3\",\"login_menu_button\":\"TopBar_login_menu_button__1n-4a\",\"login_menu_icon\":\"TopBar_login_menu_icon__RrxGE\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"collection_wrapper\":\"Collections_collection_wrapper__2SZCh\",\"collection_detail\":\"Collections_collection_detail__o9i__\",\"data_product_detail\":\"Collections_data_product_detail__2BAjE\",\"detail_header\":\"Collections_detail_header__NJGWs\",\"data_products\":\"Collections_data_products__2kvEo\",\"data_product_list\":\"Collections_data_product_list__eW67G\",\"data_product_placeholder\":\"Collections_data_product_placeholder__1AbKo\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"figure\":\"TaxaCount_figure__39iy-\",\"name-section\":\"TaxaCount_name-section__2hSvI\",\"bars-section\":\"TaxaCount_bars-section__t-boZ\",\"name\":\"TaxaCount_name__AxZqJ\",\"bar-row\":\"TaxaCount_bar-row__X-L_-\",\"bar\":\"TaxaCount_bar__2-tT3\",\"label-light\":\"TaxaCount_label-light__2xR2t\",\"label-dark\":\"TaxaCount_label-dark__2NX1i\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"App_container__MiK3W\",\"topbar\":\"App_topbar__Qqa7Z\",\"site_content\":\"App_site_content__2YtWp\",\"left_navbar\":\"App_left_navbar__SQTn7\",\"page_content\":\"App_page_content__1GAyC\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"card\":\"Card_card__jyC8Z\",\"clickable\":\"Card_clickable__1doGq\",\"selected\":\"Card_selected__3o-UM\",\"image-wrapper\":\"Card_image-wrapper__13Ywd\",\"body\":\"Card_body__1DUfD\",\"subtitle\":\"Card_subtitle__2_Js4\",\"card-list\":\"Card_card-list__1IhM2\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"nav_list\":\"LeftNavBar_nav_list__iLWGq\",\"nav_item\":\"LeftNavBar_nav_item__35CL2\",\"active\":\"LeftNavBar_active__38wjJ\",\"nav_icon\":\"LeftNavBar_nav_icon__e2bJK\",\"nav_desc\":\"LeftNavBar_nav_desc__1vXc6\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"react-select\":\"Select_react-select__3AP0a\",\"react-select--right\":\"Select_react-select--right__3i7Ff\",\"option_content\":\"Select_option_content__MAs3-\",\"option_content_icon\":\"Select_option_content_icon__30ltO\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"narratives\":\"Profile_narratives__23Ewd\",\"profile\":\"Profile_profile__OB4QD\",\"profile-narratives\":\"Profile_profile-narratives__2-BrG\",\"profile-nav\":\"Profile_profile-nav__O_pFN\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"button\":\"Button_button__dy3Mj\",\"button--orange\":\"Button_button--orange__qz8LE\",\"button--yellow\":\"Button_button--yellow__39O2j\",\"button--green\":\"Button_button--green__1jnMN\",\"button--grellow\":\"Button_button--grellow__XMsIY\",\"button--blue\":\"Button_button--blue__1qDlS\",\"button--ocean_blue\":\"Button_button--ocean_blue__1duT1\",\"button--teal\":\"Button_button--teal__2EkA4\",\"button--purple\":\"Button_button--purple__3iYfW\",\"button--frost_blue\":\"Button_button--frost_blue__3z68r\",\"button--red\":\"Button_button--red__1uXEY\",\"button--grey\":\"Button_button--grey__2blQ7\",\"button--white\":\"Button_button--white__113aw\",\"button--black\":\"Button_button--black__xRyDK\",\"button--ink\":\"Button_button--ink__2A2yA\",\"button--neutral\":\"Button_button--neutral__1N09L\",\"button--silver\":\"Button_button--silver__vJtBR\",\"button--base-lightest\":\"Button_button--base-lightest__1VdzN\",\"button--base-lighter\":\"Button_button--base-lighter__2fatb\",\"button--base-light\":\"Button_button--base-light__2MHXG\",\"button--base\":\"Button_button--base__1K6ls\",\"button--base-dark\":\"Button_button--base-dark__3FBIk\",\"button--base-darkest\":\"Button_button--base-darkest__1svmv\",\"button--primary-lightest\":\"Button_button--primary-lightest__2PHrk\",\"button--primary-lighter\":\"Button_button--primary-lighter__1eKQI\",\"button--primary-light\":\"Button_button--primary-light__1e3vb\",\"button--primary\":\"Button_button--primary__CMiIk\",\"button--primary-vivid\":\"Button_button--primary-vivid__1ZWxc\",\"button--primary-dark\":\"Button_button--primary-dark__fQWHL\",\"button--primary-darker\":\"Button_button--primary-darker__xKZUS\",\"button--secondary-lightest\":\"Button_button--secondary-lightest__38WC2\",\"button--secondary-lighter\":\"Button_button--secondary-lighter__3vQVa\",\"button--secondary-light\":\"Button_button--secondary-light__uMEFl\",\"button--secondary\":\"Button_button--secondary__1e0cQ\",\"button--secondary-vivid\":\"Button_button--secondary-vivid__2A61H\",\"button--secondary-dark\":\"Button_button--secondary-dark__1LQ2V\",\"button--secondary-darkest\":\"Button_button--secondary-darkest__2Jz7d\",\"button--accent-cool-lightest\":\"Button_button--accent-cool-lightest__3Zu74\",\"button--accent-cool-lighter\":\"Button_button--accent-cool-lighter__3fti9\",\"button--accent-cool-light\":\"Button_button--accent-cool-light__1yyds\",\"button--accent-cool\":\"Button_button--accent-cool__3Xgd-\",\"button--accent-cool-dark\":\"Button_button--accent-cool-dark__2hDMk\",\"button--accent-cool-darker\":\"Button_button--accent-cool-darker__immsh\",\"button--accent-warm-lightest\":\"Button_button--accent-warm-lightest__Xla-z\",\"button--accent-warm-lighter\":\"Button_button--accent-warm-lighter__2jrDk\",\"button--accent-warm-light\":\"Button_button--accent-warm-light__2G7qV\",\"button--accent-warm\":\"Button_button--accent-warm__vXmYD\",\"button--accent-warm-dark\":\"Button_button--accent-warm-dark__1Nuye\",\"button--accent-warm-darker\":\"Button_button--accent-warm-darker__1cOoV\",\"button--success-lightest\":\"Button_button--success-lightest__2wUDb\",\"button--success-lighter\":\"Button_button--success-lighter__2j8wQ\",\"button--success-light\":\"Button_button--success-light__2aE0B\",\"button--success\":\"Button_button--success__3vCMU\",\"button--success-dark\":\"Button_button--success-dark__G5BI0\",\"button--success-darker\":\"Button_button--success-darker__iR1cJ\",\"button--info-lightest\":\"Button_button--info-lightest__2dM7_\",\"button--info-lighter\":\"Button_button--info-lighter__3N_Vt\",\"button--info-light\":\"Button_button--info-light__2MiYm\",\"button--info\":\"Button_button--info__2smAM\",\"button--info-dark\":\"Button_button--info-dark__26IIe\",\"button--info-darker\":\"Button_button--info-darker__Gh1hS\",\"button--warning-lightest\":\"Button_button--warning-lightest__3ALzN\",\"button--warning-lighter\":\"Button_button--warning-lighter__372D9\",\"button--warning-light\":\"Button_button--warning-light__qDy6U\",\"button--warning\":\"Button_button--warning__3RIhA\",\"button--warning-dark\":\"Button_button--warning-dark__3LFfO\",\"button--warning-darker\":\"Button_button--warning-darker__JYMGP\",\"button--error-lightest\":\"Button_button--error-lightest__3dK53\",\"button--error-lighter\":\"Button_button--error-lighter__1iMHm\",\"button--error-light\":\"Button_button--error-light__3SizE\",\"button--error\":\"Button_button--error__3mR9r\",\"button--error-dark\":\"Button_button--error-dark__3Q7ul\",\"button--error-darker\":\"Button_button--error-darker__3UV_y\",\"button--disabled-lightest\":\"Button_button--disabled-lightest__1ijlQ\",\"button--disabled-light\":\"Button_button--disabled-light__2ceGa\",\"button--disabled\":\"Button_button--disabled__3T0_E\",\"button--disabled-dark\":\"Button_button--disabled-dark__-1HHP\",\"button--mid-green\":\"Button_button--mid-green__2TurF\",\"button--mid-blue\":\"Button_button--mid-blue__1QNpx\",\"button--icon-app\":\"Button_button--icon-app__3Tz2h\",\"button--icon-generic\":\"Button_button--icon-generic__YlhDR\",\"button--icon-type\":\"Button_button--icon-type__k35QE\",\"button--created\":\"Button_button--created__1tQgc\",\"button--estimating\":\"Button_button--estimating__3y4VD\",\"button--queued\":\"Button_button--queued__3FS55\",\"button--running\":\"Button_button--running__3kPz5\",\"button--completed\":\"Button_button--completed__zAYQj\",\"button--terminated\":\"Button_button--terminated__2tKSS\",\"button--does_not_exist\":\"Button_button--does_not_exist__3z4Im\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"dropdown\":\"Dropdown_dropdown__QusLm\"};","import { TypedUseSelectorHook, useDispatch, useSelector } from 'react-redux';\nimport type { RootState, AppDispatch } from '../app/store';\n\n// Use throughout the app instead of plain `useDispatch` and `useSelector`\nexport const useAppDispatch = () => useDispatch<AppDispatch>();\nexport const useAppSelector: TypedUseSelectorHook<RootState> = useSelector;\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { useEffect } from 'react';\nimport { useAppDispatch } from '../../common/hooks';\n\ninterface PageState {\n  pageTitle: string;\n  environment: 'unknown' | 'production' | 'ci' | 'appdev' | 'ci-europa';\n}\nexport const initialState: PageState = {\n  pageTitle: document.title || 'KBase',\n  environment: 'unknown',\n};\n\nexport const pageSlice = createSlice({\n  name: 'page',\n  initialState,\n  reducers: {\n    setPageTitle: (state, action: PayloadAction<string>) => {\n      state.pageTitle = action.payload;\n    },\n    setEnvironment: (\n      state,\n      action: PayloadAction<PageState['environment']>\n    ) => {\n      state.environment = action.payload;\n    },\n  },\n});\n\nexport default pageSlice.reducer;\nexport const { setPageTitle, setEnvironment } = pageSlice.actions;\n\n// Hook to set the page & document title. Resets the title on unmount\nexport const usePageTitle = (title: string) => {\n  const dispatch = useAppDispatch();\n  useEffect(() => {\n    dispatch(setPageTitle(title));\n    document.title =\n      title === initialState.pageTitle\n        ? initialState.pageTitle\n        : `${initialState.pageTitle}${title ? `: ${title}` : ''}`;\n    return () => {\n      dispatch(setPageTitle(initialState.pageTitle));\n      document.title = initialState.pageTitle;\n    };\n  }, [dispatch, title]);\n  return null;\n};\n","import { BaseQueryApi } from '@reduxjs/toolkit/dist/query/baseQueryTypes';\nimport { FetchBaseQueryArgs } from '@reduxjs/toolkit/dist/query/fetchBaseQuery';\nimport {\n  BaseQueryFn,\n  FetchArgs,\n  fetchBaseQuery,\n  FetchBaseQueryError,\n} from '@reduxjs/toolkit/query/react';\nimport { RootState } from '../../../app/store';\nimport { serviceWizardApi } from '../serviceWizardApi';\n\nexport interface DynamicService {\n  name: string;\n  release: string;\n}\n\nexport interface StaticService {\n  url: string;\n}\n\nexport interface JsonRpcQueryArgs {\n  apiType: 'JsonRpc';\n  service: StaticService | DynamicService;\n  method: string;\n  params: unknown[];\n  fetchArgs?: FetchArgs;\n}\n\nexport interface HttpQueryArgs extends FetchArgs {\n  apiType: 'Http';\n  service: StaticService;\n}\n\nexport type KbQueryArgs = JsonRpcQueryArgs | HttpQueryArgs;\n\nexport const isDynamic = (\n  service: DynamicService | StaticService\n): service is DynamicService => {\n  return (service as StaticService).url === undefined;\n};\n\ntype JsonRpcError = {\n  version: '1.1';\n  id: number;\n  error: {\n    name: string;\n    code: number;\n    message: string;\n  };\n};\n\nconst isJsonRpcError = (obj: unknown): obj is JsonRpcError => {\n  if (\n    typeof obj === 'object' &&\n    obj !== null &&\n    ['version', 'error', 'id'].every((k) => k in obj)\n  ) {\n    const { version, error } = obj as { version: unknown; error: unknown };\n    if (version !== '1.1') return false;\n    if (\n      typeof error === 'object' &&\n      error !== null &&\n      ['name', 'code', 'message'].every((k) => k in error)\n    ) {\n      return true;\n    }\n  }\n  return false;\n};\n\nexport type KBaseBaseQueryError =\n  | FetchBaseQueryError\n  | {\n      status: 'JSONRPC_ERROR';\n      data: JsonRpcError;\n    };\n\n// These helpers let us avoid circular dependencies when using an API endpoint within kbaseBaseQuery\nconst consumedServices: { serviceWizardApi?: typeof serviceWizardApi } = {};\nexport const setConsumedService = <T extends keyof typeof consumedServices>(\n  k: T,\n  v: typeof consumedServices[T]\n) => {\n  consumedServices[k] = v;\n};\nexport const getConsumedService = <T extends keyof typeof consumedServices>(\n  k: T\n) => {\n  if (!consumedServices[k]) {\n    throw new Error(`Consumed service ${k} was not set prior to use.`);\n  }\n  return consumedServices[k] as NonNullable<typeof consumedServices[T]>;\n};\n\nconst getServiceUrl = async (\n  name: string,\n  release: string,\n  baseQueryAPI: BaseQueryApi\n): Promise<\n  { url: string; error?: never } | { url?: never; error: KBaseBaseQueryError }\n> => {\n  // get serviceWizardApi while avoiding circular imports\n  // (as serviceWizardApi imports this file)\n  const serviceStatusQuery =\n    getConsumedService('serviceWizardApi').endpoints.serviceStatus;\n\n  const wizardQueryArgs = {\n    module_name: name,\n    version: release,\n  };\n\n  // trigger query, subscribing until we grab the value\n  const statusQuery = baseQueryAPI.dispatch(\n    serviceStatusQuery.initiate(wizardQueryArgs, {\n      subscribe: true,\n      forceRefetch: 300, // refetch if its been over 5 minutes\n    })\n  );\n\n  // wait until the query completes\n  await statusQuery;\n\n  // Get query result from the cache after the query has completed\n  const state = baseQueryAPI.getState() as RootState;\n  const wizardResult = serviceStatusQuery.select(wizardQueryArgs)(state);\n\n  // Raise any errors from the above call to service_wizard\n  if (wizardResult.isError) {\n    return { error: wizardResult.error as KBaseBaseQueryError };\n  }\n\n  // Get URL from wizardResult, no error so assert as a string;\n  const serviceUrl = wizardResult.data?.[0].url as string;\n\n  // release the statusQuery sub\n  statusQuery.unsubscribe();\n\n  return { url: serviceUrl };\n};\n\nexport const kbaseBaseQuery: (\n  fetchBaseQueryArgs: FetchBaseQueryArgs\n) => BaseQueryFn<KbQueryArgs, unknown, KBaseBaseQueryError> = (\n  fetchBaseQueryArgs\n) => {\n  // Add auth logic to base query args\n  const modifiedArgs: FetchBaseQueryArgs = {\n    ...fetchBaseQueryArgs,\n    prepareHeaders: async (headers, api) => {\n      if (fetchBaseQueryArgs.prepareHeaders) {\n        await fetchBaseQueryArgs.prepareHeaders(headers, api);\n      }\n      const token = (api.getState() as RootState).auth.token;\n\n      // If we have a token set in state, let's assume that we should be passing it.\n      if (token) {\n        headers.set('authorization', `${token}`);\n      }\n      return headers;\n    },\n  };\n\n  // generate base query\n  const rawBaseQuery = fetchBaseQuery(modifiedArgs);\n\n  // wrap base query to add error handling and return\n  const kbQuery: BaseQueryFn<KbQueryArgs, unknown, KBaseBaseQueryError> =\n    async (kbQueryArgs, baseQueryAPI, extraOptions) => {\n      // If this is a Http query, call rawBaseQuery directly, after prepending the service url\n      if (kbQueryArgs.apiType === 'Http') {\n        const fetchArgs = {\n          ...kbQueryArgs,\n          url: new URL(\n            [kbQueryArgs.service.url, kbQueryArgs.url].reduce<string>(\n              (url, part) =>\n                (url.endsWith('/') ? url : url + '/') +\n                (part && part.startsWith('/') ? part.slice(1) : part),\n              fetchBaseQueryArgs.baseUrl || ''\n            )\n          ).toString(),\n        };\n        return rawBaseQuery(fetchArgs, baseQueryAPI, extraOptions);\n      }\n      // Otherwise, this is a JSON-RPC query\n      // If this is a dynamic query, call service_wizard and transform it into a static one\n      if (isDynamic(kbQueryArgs.service)) {\n        // call service wizard to get the URL\n        const serviceUrl = await getServiceUrl(\n          kbQueryArgs.service.name,\n          kbQueryArgs.service.release,\n          baseQueryAPI\n        );\n        if (serviceUrl.error) return { error: serviceUrl.error };\n        // Now that we have a URL we can re-run the kbQuery as a static service\n        return kbQuery(\n          {\n            ...kbQueryArgs,\n            service: {\n              ...kbQueryArgs.service,\n              url: serviceUrl.url,\n            },\n          },\n          baseQueryAPI,\n          extraOptions\n        );\n      }\n\n      // Generate JsonRpc request id\n      const reqId = Math.random();\n\n      // generate request body\n      const fetchArgs = {\n        url: new URL(\n          kbQueryArgs.service.url,\n          fetchBaseQueryArgs.baseUrl\n        ).toString(),\n        method: 'POST',\n        body: {\n          version: '1.1', // TODO: conditionally implement JsonRpc 2.0\n          id: reqId,\n          method: kbQueryArgs.method,\n          params: kbQueryArgs.params,\n        },\n        ...kbQueryArgs.fetchArgs, // Allow overriding JsonRpc defaults\n      };\n\n      // make request\n      const request = rawBaseQuery(fetchArgs, baseQueryAPI, extraOptions);\n      const response = await request;\n\n      // identify and better differentiate jsonRpc errors\n      if (response.error && response.error.status === 500) {\n        if (isJsonRpcError(response.error.data)) {\n          if (response.error.data.id && response.error.data.id !== reqId) {\n            return {\n              error: {\n                status: 'CUSTOM_ERROR',\n                error: 'JsonRpcProtocolError',\n                data: `Response ID \"${response.error.data.id}\" !== Request ID \"${reqId}\"`,\n              },\n            };\n          }\n          return {\n            error: {\n              status: 'JSONRPC_ERROR',\n              data: response.error.data,\n            },\n          };\n        }\n      }\n\n      // If another error has occurred preventing a response, return default rtk-query response.\n      // This appropriately handles rtk-query internal errors\n      if (!response.data) return request;\n\n      // From here, assume we have a jsonRpc response\n      const data = response.data as {\n        version: string;\n        result?: unknown;\n        error?: unknown;\n        id?: number;\n      };\n\n      // If the IDs don't match, fail\n      // TODO: find out if this is the idiomatic way to do this\n      if (data.id && data.id !== reqId) {\n        return {\n          error: {\n            status: 'CUSTOM_ERROR',\n            error: 'JsonRpcProtocolError',\n            data: `Response ID \"${data.id}\" !== Request ID \"${reqId}\"`,\n          },\n        };\n      }\n\n      // All went well, return the JsonRpc result\n      return { data: data.result };\n    };\n  return kbQuery;\n};\n","import { kbaseBaseQuery } from './utils/kbaseBaseQuery';\nimport { createApi } from '@reduxjs/toolkit/query/react';\n\nconst ENV = process.env.REACT_APP_KBASE_ENV;\nconst baseUrl =\n  process.env.NODE_ENV === 'development'\n    ? 'http://localhost:3000/'\n    : `https://${ENV === 'PROD' ? '' : `${ENV}.`}kbase.us`;\n\nexport const baseApi = createApi({\n  reducerPath: 'combinedApi',\n  baseQuery: kbaseBaseQuery({ baseUrl }),\n  endpoints: () => ({}),\n});\n","import { JsonRpcQueryArgs, HttpQueryArgs } from './kbaseBaseQuery';\n\n// Helpers for adding service info to each query,\nexport const jsonRpcService = (\n  service: JsonRpcQueryArgs['service']\n): ((\n  queryArgs: Omit<JsonRpcQueryArgs, 'service' | 'apiType'>\n) => JsonRpcQueryArgs) => {\n  return (queryArgs) => ({\n    apiType: 'JsonRpc',\n    service: service,\n    ...queryArgs,\n  });\n};\n\nexport const httpService = (\n  service: HttpQueryArgs['service']\n): ((\n  queryArgs: Omit<HttpQueryArgs, 'service' | 'apiType'>\n) => HttpQueryArgs) => {\n  return (queryArgs) => ({\n    apiType: 'Http',\n    service: service,\n    ...queryArgs,\n  });\n};\n","/**\n * Utility functions for manipulating strings.\n */\n\n/**\n * Make a readable string from a snake-case string\n * Eg. \"comparative_genomics\" -> \"Comparative genomics\"\n * This makes the string sentence case. E.g.:\n * some_kind_of_string -> Some kind of string\n * @param {string} str the snake-case string to change\n * @return {string}\n */\nexport function snakeCaseToHumanReadable(str: string): string {\n  str = str.replace(/_/g, ' ');\n  str = str[0].toUpperCase() + str.slice(1);\n  return str;\n}\n\n/**\n * Get a friendly readable name from a workspace object type\n * E.g. \"KBaseMatrices.AmpliconMatrix-1.2\" -> \"Amplicon Matrix\"\n * @param {string} type the workspace type string to break apart\n * @return {string}\n */\nexport function getWSTypeName(type: string): string {\n  const matches = type.match(/[a-zA-Z]*\\.([a-zA-Z]+)(-\\d+\\.\\d+)?/);\n  if (!matches || matches.length < 2) {\n    throw new Error('Invalid workspace type name: ' + type);\n  }\n  const match = matches[1];\n  // Insert a space before all caps and trim\n  return match.replace(/([A-Z][a-z])/g, ' $1').trim();\n}\n\n/**\n * Template string tag function for encoding values for a URI with encodeURIComponent\n * ```\n * import { uriEncodeTemplateTag as encode } from './stringUtils';\n * const unencoded_var = 'var_content?';\n * const encoded = encode`/uri/path/${'/foo/foo'}/more/path/${unencoded_var}`\n * // encoded === \"/uri/path/%2Ffoo%2Ffoo/more/path/var_content%3F\"\n * ```\n */\nexport function uriEncodeTemplateTag(\n  strings: TemplateStringsArray,\n  ...values: unknown[]\n) {\n  let output = '';\n  const stringsArr = [...strings];\n  while (stringsArr.length || values.length) {\n    if (stringsArr.length) output += stringsArr.shift();\n    if (values.length) {\n      const value = values.shift();\n      const valueSafe = (\n        ['string', 'boolean', 'number'].includes(typeof value)\n          ? value\n          : String(value)\n      ) as string | boolean | number;\n      output += encodeURIComponent(valueSafe);\n    }\n  }\n  return output;\n}\n","import { baseApi } from './index';\nimport { httpService } from './utils/serviceHelpers';\nimport { uriEncodeTemplateTag as encode } from '../utils/stringUtils';\n\nconst authService = httpService({\n  url: '/services/auth',\n});\n\ninterface TokenResponse {\n  created: number;\n  expires: number;\n  id: string;\n  name: string | null;\n  type: string;\n  user: string;\n  cachefor: number;\n}\n\n// Auth does not use JSONRpc, so we use queryFn to make custom queries\nexport const authApi = baseApi.injectEndpoints({\n  endpoints: (builder) => ({\n    authFromToken: builder.query<TokenResponse, string>({\n      query: (token) =>\n        authService({\n          url: '/api/V2/token',\n          method: 'GET',\n          headers: {\n            Authorization: token || '',\n          },\n        }),\n    }),\n    revokeToken: builder.mutation<boolean, string>({\n      query: (tokenId) =>\n        authService({\n          url: encode`/tokens/revoke/${tokenId}`,\n          method: 'DELETE',\n        }),\n    }),\n  }),\n});\n\nexport const { authFromToken, revokeToken } = authApi.endpoints;\n","import { useEffect, useMemo, useState } from 'react';\n\nexport function getCookie(name: string) {\n  const cookie = document.cookie\n    .split(';')\n    .map((kv) => kv.trim().split('='))\n    .find(([k, _v]) => k.trim() === name);\n  if (cookie) {\n    return cookie[1];\n  } else {\n    return undefined;\n  }\n}\n\nexport function setCookie(\n  name: string,\n  value: string,\n  options?: {\n    expires?: Date;\n    path?: string | null;\n    domain?: string;\n    secure?: boolean;\n    SameSite?: 'Lax' | 'Strict' | 'None';\n  }\n) {\n  const { expires, path, domain, secure, SameSite } = {\n    path: '/',\n    secure: true,\n    SameSite: 'Lax',\n    ...options,\n  };\n  let cookieString = `${name}=${value}`;\n  if (expires) cookieString += `;expires=${expires.toUTCString()}`;\n  if (path) cookieString += `;path=${path}`;\n  if (domain) cookieString += `;domain=${domain}`;\n  if (SameSite) cookieString += `;SameSite=${SameSite}`;\n  if (secure) cookieString += ';secure';\n  document.cookie = cookieString;\n}\n\nexport function clearCookie(\n  name: string,\n  options?: Omit<Parameters<typeof setCookie>[2], 'expires'>\n) {\n  setCookie(name, '', {\n    ...options,\n    expires: new Date('Thu, 01 Jan 1970 00:00:00 GMT'),\n  });\n}\n\ntype Rest<T extends unknown[]> = ((...p: T) => void) extends (\n  p1: infer P1,\n  ...rest: infer R\n) => void\n  ? R\n  : never;\n\ntype wrappedFuncs = {\n  clear: (\n    ...args: Rest<Parameters<typeof clearCookie>>\n  ) => ReturnType<typeof clearCookie>;\n  set: (\n    ...args: Rest<Parameters<typeof setCookie>>\n  ) => ReturnType<typeof setCookie>;\n};\n\nexport function useCookie(name: string) {\n  const [value, setValue] = useState<undefined | string>(getCookie(name));\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      const cookieVal = getCookie(name);\n      if (cookieVal !== value) setValue(cookieVal);\n    }, 100);\n    return () => clearInterval(interval);\n  }, [name, value, setValue]);\n\n  const funcs: wrappedFuncs = useMemo(\n    () => ({\n      clear: (...args) => {\n        const result = clearCookie(name, ...args); // lgtm [js/use-of-returnless-function]\n        setValue(getCookie(name));\n        return result;\n      },\n      set: (...args) => {\n        const result = setCookie(name, ...args); // lgtm [js/use-of-returnless-function]\n        setValue(getCookie(name));\n        return result;\n      },\n    }),\n    [name, setValue]\n  );\n\n  return [value, funcs.set, funcs.clear] as const;\n}\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { useEffect } from 'react';\nimport { RootState } from '../../app/store';\nimport { authFromToken, revokeToken } from '../../common/api/authService';\nimport { useCookie } from '../../common/cookie';\nimport { useAppDispatch, useAppSelector } from '../../common/hooks';\n\nexport interface TokenInfo {\n  created: number;\n  expires: number;\n  id: string;\n  name: string | null;\n  type: string;\n  user: string;\n  cachefor: number;\n}\n\ninterface AuthState {\n  initialized: boolean;\n  token?: string;\n  username?: string;\n  tokenInfo?: TokenInfo;\n}\n\nconst initialState: AuthState = {\n  initialized: false,\n};\n\nexport const authSlice = createSlice({\n  name: 'auth',\n  initialState,\n  reducers: {\n    setAuth: (\n      state,\n      {\n        payload,\n      }: PayloadAction<{\n        token: string;\n        username: string;\n        tokenInfo: TokenInfo;\n      } | null>\n    ) => {\n      const normToken = normalizeToken(payload?.token);\n      state.token = normToken;\n      state.username = payload?.username;\n      state.tokenInfo = payload?.tokenInfo;\n      state.initialized = true;\n    },\n  },\n  extraReducers: (builder) =>\n    builder.addMatcher(revokeToken.matchFulfilled, (state, action) => {\n      // Clear current token if it's been revoked when revokeToken succeeds\n      const revokedTokenId = action.meta.arg.originalArgs;\n      if (revokedTokenId === state.tokenInfo?.id) {\n        state.token = undefined;\n        state.username = undefined;\n        state.tokenInfo = undefined;\n      }\n    }),\n});\n\nexport default authSlice.reducer;\nexport const { setAuth } = authSlice.actions;\n\nexport const authUsername = (state: RootState) => {\n  return state.auth.username;\n};\n\nexport const authToken = (state: RootState) => {\n  return state.auth.token;\n};\n\nexport const authInitialized = (state: RootState) => {\n  return state.auth.initialized;\n};\n\nexport const useTryAuthFromToken = (token?: string) => {\n  const dispatch = useAppDispatch();\n  const currentToken = useAppSelector(authToken);\n  const normToken = normalizeToken(token, '');\n\n  const tokenQuery = authFromToken.useQuery(normToken, {\n    skip: !normToken,\n  });\n\n  useEffect(() => {\n    if (tokenQuery.isSuccess && normToken !== currentToken) {\n      dispatch(\n        setAuth({\n          token: normToken,\n          username: tokenQuery.data.user,\n          tokenInfo: tokenQuery.data,\n        })\n      );\n    }\n  }, [\n    currentToken,\n    dispatch,\n    normToken,\n    tokenQuery.data,\n    tokenQuery.isSuccess,\n  ]);\n\n  return tokenQuery;\n};\n\n/**\n * Initializes auth from a cookie, then continues to monitor and update that cookie as appropriate.\n */\nexport const useTokenCookie = (name: string) => {\n  const dispatch = useAppDispatch();\n\n  // Pull token from cookie. If it exists, and differs from state, try it for auth.\n  const [cookieToken, setCookieToken, clearCookieToken] = useCookie(name);\n  const { isSuccess, isFetching } = useTryAuthFromToken(cookieToken);\n\n  // Pull token, expiration, and init info from auth state\n  const token = useAppSelector(authToken);\n  const expires = useAppSelector(({ auth }) => auth.tokenInfo?.expires);\n  const initialized = useAppSelector(authInitialized);\n\n  // Initializes auth for states where useTryAuthFromToken does not set auth\n  useEffect(() => {\n    if (isFetching || initialized) return;\n    if (!cookieToken) {\n      dispatch(setAuth(null));\n    } else if (!isSuccess) {\n      dispatch(setAuth(null));\n    }\n  }, [isFetching, initialized, cookieToken, dispatch, isSuccess]);\n\n  // Set the cookie according to the initialized auth state\n  useEffect(() => {\n    if (!initialized) return;\n    if (token && expires) {\n      setCookieToken(token, {\n        expires: new Date(expires),\n        ...(process.env.NODE_ENV === 'development'\n          ? {}\n          : { domain: process.env.REACT_APP_KBASE_DOMAIN }),\n      });\n    } else if (token && !expires) {\n      // eslint-disable-next-line no-console\n      console.error('Could not set token cookie, missing expire time');\n    } else if (!token) {\n      clearCookieToken();\n    }\n  }, [initialized, token, expires, setCookieToken, clearCookieToken]);\n};\n\nfunction normalizeToken(\n  t: string | undefined,\n  fallback?: undefined\n): string | undefined;\nfunction normalizeToken<T>(t: string | undefined, fallback: T): string | T;\nfunction normalizeToken<T>(t: string | undefined, fallback?: T) {\n  return t?.toUpperCase().trim() || fallback;\n}\n","import { baseApi } from './index';\nimport { jsonRpcService } from './utils/serviceHelpers';\n\nconst userProfile = jsonRpcService({\n  url: '/services/user_profile/rpc',\n});\n\ninterface UserProfileParams {\n  status: void;\n  get_user_profile: { usernames: string[] };\n  set_user_profile: {\n    profile: {\n      user: { username: string; realname: string };\n      profile: unknown;\n    };\n  };\n}\n\ninterface UserProfileResults {\n  status: unknown;\n  get_user_profile: [\n    [\n      {\n        user: { username: string; realname: string };\n        profile: unknown;\n      } | null\n    ]\n  ];\n  set_user_profile: void;\n}\n\nexport const userProfileApi = baseApi\n  .enhanceEndpoints({ addTagTypes: ['Profile'] })\n  .injectEndpoints({\n    endpoints: (builder) => ({\n      userProfileStatus: builder.query<\n        UserProfileResults['status'],\n        UserProfileParams['status']\n      >({\n        query: () =>\n          userProfile({\n            method: 'UserProfile.status',\n            params: [],\n          }),\n      }),\n\n      getUserProfile: builder.query<\n        UserProfileResults['get_user_profile'],\n        UserProfileParams['get_user_profile']\n      >({\n        query: ({ usernames }) =>\n          userProfile({\n            method: 'UserProfile.get_user_profile',\n            params: [usernames],\n          }),\n        // Cache profiles for an hour\n        keepUnusedDataFor: 3600,\n        // Tells rtk-query the cache constraints for this query\n        providesTags: (result, error, { usernames }) =>\n          usernames.map((username) => ({ type: 'Profile', id: username })),\n      }),\n\n      setUserProfile: builder.mutation<\n        UserProfileResults['set_user_profile'],\n        UserProfileParams['set_user_profile']\n      >({\n        query: ({ profile }) =>\n          userProfile({\n            method: 'UserProfile.set_user_profile',\n            params: [{ profile }],\n          }),\n        // Invalidates the cache for any queries with a matching tag\n        invalidatesTags: (result, error, { profile }) => [\n          { type: 'Profile', id: profile.user.username },\n        ],\n      }),\n    }),\n  });\n\nexport const { getUserProfile, setUserProfile, userProfileStatus } =\n  userProfileApi.endpoints;\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { useEffect, useMemo } from 'react';\nimport { RootState } from '../../app/store';\nimport { getUserProfile } from '../../common/api/userProfileApi';\nimport { useAppDispatch, useAppSelector } from '../../common/hooks';\n\n// Define a type for the slice state\nexport interface ProfileState {\n  loggedInProfile?: {\n    user: {\n      username: string;\n      realname: string;\n    };\n    profile: unknown;\n  };\n}\n\nconst initialState: ProfileState = {\n  loggedInProfile: undefined,\n};\n\nexport const profileSlice = createSlice({\n  name: 'profile',\n  initialState,\n  reducers: {\n    setLoggedInProfile: (\n      state,\n      action: PayloadAction<ProfileState['loggedInProfile']>\n    ) => {\n      state.loggedInProfile = action.payload;\n    },\n  },\n});\n\nexport default profileSlice.reducer;\nconst { setLoggedInProfile } = profileSlice.actions;\n\nexport const profileRealname = ({ profile }: RootState) =>\n  profile.loggedInProfile?.user?.realname;\n\nexport const useLoggedInProfileUser = (username?: string) => {\n  const dispatch = useAppDispatch();\n  const args = useMemo(() => ({ usernames: [username || ''] }), [username]);\n  const query = getUserProfile.useQuery(args, { skip: !username });\n  const profileUser = useAppSelector(\n    ({ profile }) => profile?.loggedInProfile?.user?.username\n  );\n\n  useEffect(() => {\n    if (query.isSuccess) {\n      // App should crash if profile DNE\n      if (!(query.data && query.data[0][0])) {\n        throw query.error;\n      }\n      // Set the logged in profile once it loads\n      if (query.isSuccess && query.data[0][0].user.username !== profileUser) {\n        dispatch(setLoggedInProfile(query.data[0][0]));\n      }\n    }\n  }, [dispatch, profileUser, query.data, query.error, query.isSuccess]);\n\n  return query;\n};\n","import { FunctionComponent as FC } from 'react';\nimport classes from './Button.module.scss';\n\nexport const Button: FC<React.ComponentProps<'button'>> = (props) => {\n  const className = [classes.button, props.className].join(' ');\n  return <button className={className} type={undefined} {...props} />;\n};\n","import { FC, ReactNode, useState, useEffect } from 'react';\nimport ReactSelect, {\n  GroupBase,\n  MultiValue,\n  OptionsOrGroups,\n  SingleValue,\n  Props as ReactSelectProps,\n} from 'react-select';\nimport AsyncSelect from 'react-select/async';\nimport classes from './Select.module.scss';\n\nexport interface SelectOption {\n  label: ReactNode;\n  value: string | number;\n  icon?: ReactNode;\n}\n\ntype OptionsArray = OptionsOrGroups<SelectOption, GroupBase<SelectOption>>;\ntype OptionsAsync = (inputValue: string) => Promise<OptionsArray>;\n\ninterface SelectProps {\n  /** Sets a className attribute on the outer component */\n  className?: string;\n  /** If true, adds a clickable icon for clearing the select */\n  clearable?: boolean;\n  /** Advanced: allows manualy manipulation of react-select subcomponents */\n  components?: ReactSelectProps<SelectOption>['components'];\n  /** If true, sets select to disabled */\n  disabled?: boolean;\n  /** Whether the dropdown select menu should be pinned to the left or right\n   * (default left) */\n  horizontalMenuAlign?: 'left' | 'right';\n  /** If true, sets select to multiple select mode */\n  multiple?: boolean;\n  /** onChange callback, triggered when the selected value changes */\n  onChange?: (value: SelectOption[]) => void;\n  /** The array of options & option groups (see react-select documentation) OR\n   * an async function which returns such an array given the input content */\n  options: OptionsArray | OptionsAsync;\n  /** If defined, sets the value of the select. */\n  value?: SingleValue<SelectOption> | MultiValue<SelectOption>;\n}\n\nexport const handleChangeFactory = (\n  callOnChange: (value: SelectOption[]) => void\n) => {\n  return (options: SingleValue<SelectOption> | MultiValue<SelectOption>) => {\n    if (options === null) return;\n    if ('value' in options) {\n      callOnChange([options]);\n    } else {\n      // multiple/no options returned\n      callOnChange([...options]);\n    }\n  };\n};\n\n/**\n * Select component that supports multiple selection, async options loading,\n * custom styling, and more.\n */\nexport const Select: FC<SelectProps> = (props) => {\n  const options = props.options;\n\n  // Detect how to format options based on if they have icons\n  const defaultHasIcons = doesHaveIcons(options);\n  const [hasIcons, setHasIcons] = useState(defaultHasIcons);\n\n  useEffect(() => {\n    // Detect if static option icons have changed\n    // needed so we can deal with icons set ansynchronously\n    if (!isFunc(options)) {\n      setHasIcons(defaultHasIcons);\n    }\n  }, [options, defaultHasIcons]);\n\n  // Add the right-aligned class if needed\n  const classNames = [classes['react-select'], props.className ?? ''];\n  if (props.horizontalMenuAlign === 'right') {\n    classNames.push(classes['react-select--right']);\n  }\n\n  const callOnChange =\n    props.onChange ??\n    (() => {\n      /* noop */\n    });\n  const handleChange = handleChangeFactory(callOnChange);\n  const handleFormatOptionLabel = (data: SelectOption) => {\n    return (\n      <span className={classes.option_content}>\n        {hasIcons && (\n          <span className={classes.option_content_icon}>{data.icon}</span>\n        )}\n        {data.label}\n      </span>\n    );\n  };\n\n  // Common between sync/async\n  const commonProps = {\n    className: classNames.join(' '),\n    /** classNamePrefix allows us to override the default styles by using global\n     * classes prefixed with the below */\n    classNamePrefix: 'react-select',\n    components: props.components,\n    formatOptionLabel: handleFormatOptionLabel,\n    isClearable: props.clearable,\n    isDisabled: props.disabled,\n    isMulti: props.multiple,\n    onChange: handleChange,\n    value: props.value,\n  };\n\n  return !isFunc(options) ? (\n    // Synchronous\n    <ReactSelect {...commonProps} options={options} />\n  ) : (\n    // Asynchronous\n    // Could later support pagination here with react-select-async-paginate\n    <AsyncSelect\n      {...commonProps}\n      loadOptions={async (inputValue: string) => {\n        const newOpts = await options(inputValue);\n        setHasIcons(doesHaveIcons(newOpts));\n        return newOpts;\n      }}\n      defaultOptions={true}\n    />\n  );\n};\n\nconst isFunc = (opts: SelectProps['options']): opts is OptionsAsync => {\n  return typeof opts === 'function';\n};\n\nconst doesHaveIcons = (opts: SelectProps['options']): boolean => {\n  // Double check that we're not dealing with async options\n  // mostly appeasing typescript here\n  if (isFunc(opts)) return false;\n  return opts.some((optionOrGroup) => {\n    if ('options' in optionOrGroup) {\n      return doesHaveIcons(optionOrGroup.options);\n    }\n    return !!optionOrGroup.icon;\n  });\n};\n","import { FC, ComponentPropsWithRef } from 'react';\nimport { components } from 'react-select';\nimport classes from './Dropdown.module.scss';\nimport { Select } from './Select';\n\nconst { DropdownIndicator } = components;\n\nexport type DropdownProps = ComponentPropsWithRef<typeof Select>;\n\nexport const Dropdown: FC<DropdownProps> = (props) => {\n  const indicator = props.children;\n  return (\n    <Select\n      {...props}\n      value={null}\n      className={[classes['dropdown'], props.className].join(' ')}\n      components={{\n        DropdownIndicator: (props) => (\n          <DropdownIndicator {...props}>{indicator}</DropdownIndicator>\n        ),\n      }}\n    />\n  );\n};\n","import { SerializedError } from '@reduxjs/toolkit';\nimport { KBaseBaseQueryError } from './kbaseBaseQuery';\n\nexport function parseError(error: KBaseBaseQueryError | SerializedError): {\n  error: KBaseBaseQueryError | SerializedError;\n  message: string;\n  code?: string | number;\n  name?: string;\n  status?: number | string;\n  stack?: string;\n} {\n  if ('status' in error) {\n    // KBaseBaseQueryError\n    if (error.status === 'JSONRPC_ERROR') {\n      // jsonRPC error\n      return {\n        message: error.data.error.message,\n        code: error.data.error.code,\n        name: error.data.error.name,\n        status: error.status,\n        error,\n      };\n    } else {\n      // FetchBaseQueryError\n      const message =\n        'error' in error ? error.error : JSON.stringify(error.data);\n      return {\n        message: message,\n        status: error.status,\n        error,\n      };\n    }\n  } else {\n    return {\n      ...error,\n      message: error.message || '',\n      error,\n    };\n  }\n}\n","import { useState, useMemo } from 'react';\nimport {\n  getUserProfile,\n  setUserProfile,\n} from '../../common/api/userProfileApi';\nimport { Button } from '../../common/components';\nimport { useAppSelector } from '../../common/hooks';\nimport { authFromToken, revokeToken } from '../../common/api/authService';\nimport { faCheck, faX, faSpinner } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon as FAIcon } from '@fortawesome/react-fontawesome';\nimport { parseError } from '../../common/api/utils/parseError';\nimport { usePageTitle } from '../layout/layoutSlice';\n\nexport default function Auth() {\n  usePageTitle('Authentication');\n  const { username, token } = useAppSelector((state) => state.auth);\n  return (\n    <div>\n      <p>\n        {token ? `You are logged in as '${username}'` : `You are not logged in`}\n      </p>\n      {token ? <LogoutForm /> : <AuthForm />}\n      <div>\n        <UserRealNameChanger />\n      </div>\n    </div>\n  );\n}\n\nconst AuthForm = () => {\n  const [tokenString, setTokenString] = useState<string>();\n  const [authFromTokenQuery, authFromTokenResult] =\n    authFromToken.useLazyQuery();\n\n  const error = authFromTokenResult.isError\n    ? parseError(authFromTokenResult.error).message\n    : null;\n\n  const handleLogin = () => {\n    if (tokenString) {\n      authFromTokenQuery(tokenString);\n    } else {\n      alert('Please enter a kbase token');\n    }\n  };\n\n  return (\n    <div>\n      <input\n        placeholder=\"kbase token\"\n        type=\"text\"\n        value={tokenString ?? ''}\n        onChange={(e) => setTokenString(e.target.value)}\n      />\n      <Button onClick={handleLogin}>Login</Button>\n      {error ? (\n        <>\n          <br />\n          <span style={{ color: 'red' }}>{error}</span>\n        </>\n      ) : null}\n    </div>\n  );\n};\n\nconst LogoutForm = () => {\n  const tokenId = useAppSelector(({ auth }) => auth.tokenInfo?.id);\n  const [revokeTokenMutation, revokeTokenResult] = revokeToken.useMutation();\n\n  const error = revokeTokenResult.isError\n    ? parseError(revokeTokenResult.error).message\n    : null;\n\n  const handleLogout = () => {\n    if (tokenId) revokeTokenMutation(tokenId);\n  };\n\n  return (\n    <div>\n      <Button onClick={handleLogout}>Logout of KBase</Button>\n      {error ? (\n        <>\n          <br />\n          <span style={{ color: 'red' }}>{error}</span>\n        </>\n      ) : null}\n    </div>\n  );\n};\n\nconst UserRealNameChanger = () => {\n  const username = useAppSelector((s) => s.auth.username);\n  const profileParams = useMemo(\n    () => ({ usernames: username ? [username] : [] }),\n    [username]\n  );\n  const profile = getUserProfile.useQuery(profileParams, { skip: !username });\n  const [updateProfile, updateProfileResult] = setUserProfile.useMutation();\n  const [nameText, setNameText] = useState('');\n\n  if (!username) return <></>;\n\n  const changeName = async () => {\n    const oldProfile = profile.data?.[0][0];\n    const newProfile: typeof oldProfile = JSON.parse(\n      JSON.stringify(profile.data?.[0][0])\n    );\n    if (newProfile === undefined || newProfile === null) return;\n    if (nameText.trim() === '') return;\n    newProfile.user.realname = nameText.trim();\n    updateProfile({ profile: newProfile });\n  };\n\n  //example for handling errors\n  if (\n    profile.error &&\n    'status' in profile.error &&\n    profile.error.status === 'JSONRPC_ERROR' &&\n    // profile.error.data now contains the narrowly typed jsonRpc error response\n    profile.error.data.error.message.includes('Something')\n  ) {\n    // handle jsonrpc errors\n  } else {\n    // handle other errors\n  }\n\n  return (\n    <div style={{ maxWidth: '10em' }}>\n      Profile:\n      {profile.isSuccess ? (\n        JSON.stringify(profile.data?.[0][0])\n      ) : profile.isError ? (\n        JSON.stringify(profile.error)\n      ) : profile.isLoading ? (\n        <FAIcon icon={faSpinner} spin />\n      ) : (\n        ' '\n      )}\n      <br />\n      <input\n        type=\"text\"\n        placeholder=\"Change Realname\"\n        value={nameText}\n        onInput={(e) => setNameText(e.currentTarget.value)}\n      />\n      <button onClick={() => changeName()}>Update</button>\n      {updateProfileResult.isLoading ? <FAIcon icon={faSpinner} spin /> : null}\n      {updateProfileResult.isSuccess ? <FAIcon icon={faCheck} /> : null}\n      {updateProfileResult.isError ? <FAIcon icon={faX} /> : null}\n    </div>\n  );\n};\n","import { createSlice } from '@reduxjs/toolkit';\nimport type { RootState } from '../../app/store';\n\n// Define a type for the slice state\ninterface CountState {\n  count: number;\n}\n\n// Define the initial state using that type\nconst initialState: CountState = {\n  count: 0,\n};\n\nexport const countSlice = createSlice({\n  name: 'count',\n  // `createSlice` will infer the state type from the `initialState` argument\n  initialState,\n  reducers: {\n    increment: (state) => {\n      state.count += 1;\n    },\n  },\n});\n\nexport default countSlice.reducer;\nexport const { increment } = countSlice.actions;\n// Other code such as selectors can use the imported `RootState` type\nexport const countStatus = (state: RootState) => state.count.count;\n","import { Button } from '../../common/components';\nimport { useAppSelector, useAppDispatch } from '../../common/hooks';\nimport { usePageTitle } from '../layout/layoutSlice';\nimport { countStatus, increment } from '../count/countSlice';\n\nconst Counter = () => {\n  const currentCount = useAppSelector(countStatus);\n  return <>{currentCount}</>;\n};\n\nexport default function Count() {\n  usePageTitle('Count');\n  const dispatch = useAppDispatch();\n  const doIncrement = () => {\n    dispatch(increment());\n  };\n  return (\n    <section>\n      <h2>\n        The count is: <Counter />\n      </h2>\n      <Button onClick={() => doIncrement()}>Add</Button>\n    </section>\n  );\n}\n","import { RefObject, useEffect, useRef, useState } from 'react';\nimport { useLocation, useNavigate } from 'react-router-dom';\nimport { usePageTitle } from '../layout/layoutSlice';\nimport { useTryAuthFromToken } from '../auth/authSlice';\n\nexport const LEGACY_BASE_ROUTE = '/legacy';\n\nexport default function Legacy() {\n  // TODO: external navigation and <base target=\"_top\"> equivalent\n\n  // TODO: consider adding integration tests for this feature, as unit tests\n  // cannot test this component effectively\n\n  const location = useLocation();\n  const navigate = useNavigate();\n\n  const legacyContentRef = useRef<HTMLIFrameElement>(null);\n  const [legacyTitle, setLegacyTitle] = useState('');\n  usePageTitle(legacyTitle);\n\n  // The path that should be in the iframe based on the current parent window location\n  const expectedLegacyPath = getLegacyPart(\n    location.pathname + location.search + location.hash\n  );\n  // The actual current path, set by navigation events from kbase-ui\n  const [legacyPath, setLegacyPath] = useState(expectedLegacyPath);\n\n  // State for token recieved via postMessage, for setting auth\n  const [recievedToken, setReceivedToken] = useState<string | undefined>();\n  // when recievedToken is defined and !== current token, this will try it for auth\n  useTryAuthFromToken(recievedToken);\n\n  // Listen for messages from the iframe\n  useMessageListener(legacyContentRef, (e) => {\n    const d = e.data;\n    if (isRouteMessage(d)) {\n      // Navigate the parent window when the iframe sends a navigation event\n      let path = d.payload.request.original;\n      if (path[0] === '/') path = path.slice(1);\n      if (legacyPath !== path) {\n        setLegacyPath(path);\n        navigate(`./${path}`);\n      }\n    } else if (isTitleMessage(d)) {\n      setLegacyTitle(d.payload);\n    } else if (isAuthMessage(d)) {\n      if (d.payload.token) {\n        setReceivedToken(d.payload.token);\n      }\n    }\n  });\n\n  // The following enables navigation events from Europa to propagate to the\n  // iframe. When expectedLegacyPath (from the main window URL) changes, check\n  // that legacyPath (from the iframe) martches, otherwise, send the iframe a\n  // postMessage with navigation instructions. legacyPath will be updated\n  // downstream (the ui navigation event will send a message back to europa with\n  // the new route). We only want to watch for changes on expectedLegacyPath\n  // here, as watching legacyPath will cause this to run any time the iframe's\n  // location changes.\n  useEffect(() => {\n    if (\n      expectedLegacyPath !== legacyPath &&\n      legacyContentRef.current?.contentWindow\n    ) {\n      legacyContentRef.current.contentWindow.postMessage(\n        {\n          source: 'europa.navigate',\n          payload: { path: expectedLegacyPath },\n        },\n        '*'\n      );\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [expectedLegacyPath, legacyContentRef]);\n\n  return (\n    <div\n      data-testid=\"legacy-iframe-wrapper\"\n      style={{\n        display: 'flex',\n        width: '100%',\n        height: '100%',\n        flexFlow: 'column nowrap',\n      }}\n    >\n      <iframe\n        frameBorder=\"0\"\n        // We want the src to always match the content of the iframe, so as not to\n        // cause the iframe to reload inappropriately\n        src={formatLegacyUrl(legacyPath)}\n        ref={legacyContentRef}\n        title=\"Legacy Content Wrapper\"\n        width=\"100%\"\n        height=\"100%\"\n      />\n    </div>\n  );\n}\n\nconst legacyRegex = new RegExp(`(?:${LEGACY_BASE_ROUTE})(?:/+(.*))$`);\nexport const getLegacyPart = (path: string) =>\n  path.match(legacyRegex)?.[1] || '/';\n\nexport const formatLegacyUrl = (path: string) =>\n  `https://${process.env.REACT_APP_KBASE_LEGACY_DOMAIN}/#${path}`;\n\nexport const useMessageListener = function <T = unknown>(\n  target: RefObject<HTMLIFrameElement>,\n  handler: (ev: MessageEvent<T>) => void\n) {\n  useEffect(() => {\n    const wrappedHandler = (ev: MessageEvent<T>) => {\n      // When deployed we only want to listen to messages from the iframe itself\n      // but we want to allow other sources for dev/test.\n      if (\n        process.env.NODE_ENV === 'production' &&\n        ev.source !== target.current?.contentWindow\n      )\n        return;\n      handler(ev);\n    };\n    window.addEventListener('message', wrappedHandler);\n    return () => {\n      window.removeEventListener('message', wrappedHandler);\n    };\n  }, [handler, target]);\n};\n\ntype Message<S extends string, P> = {\n  source: S;\n  payload: P;\n};\n\nconst messageGuard = <S extends string, P>(\n  source: S,\n  payloadGuard: (payload: unknown) => payload is P\n) => {\n  type Guarded = Message<S, P>;\n  return (recieved: unknown): recieved is Guarded =>\n    typeof recieved === 'object' &&\n    ['source', 'payload'].every(\n      (k) => k in (recieved as Record<string, never>)\n    ) &&\n    (recieved as Guarded).source === source &&\n    payloadGuard((recieved as Guarded).payload);\n};\n\nexport const isTitleMessage = messageGuard(\n  'kbase-ui.ui.setTitle',\n  (payload): payload is string => typeof payload === 'string'\n);\n\nexport const isRouteMessage = messageGuard(\n  'kbase-ui.app.route-component',\n  (payload): payload is { request: { original: string } } =>\n    !!payload &&\n    typeof payload === 'object' &&\n    'request' in (payload as Record<string, never>) &&\n    typeof (payload as Record<string, unknown>).request === 'object' &&\n    'original' in (payload as Record<string, Record<string, never>>).request &&\n    typeof (payload as Record<string, Record<string, string>>).request\n      .original === 'string'\n);\n\nexport const isAuthMessage = messageGuard(\n  'kbase-ui.session.loggedin',\n  (payload): payload is { token: string | null } =>\n    !!payload &&\n    typeof payload === 'object' &&\n    'token' in (payload as Record<string, never>) &&\n    (typeof (payload as Record<string, unknown>).token === 'string' ||\n      (payload as Record<string, unknown>).token === null)\n);\n","import { usePageTitle } from '../layout/layoutSlice';\n\nexport default function Navigator() {\n  usePageTitle('Narrative Navigator');\n  return (\n    <section>\n      <h2>Nothing here yet</h2>\n    </section>\n  );\n}\n","import { FC } from 'react';\n\nconst PageNotFound: FC = () => (\n  <>\n    <section>\n      <h2>Page Not Found.</h2>\n    </section>\n  </>\n);\n\nexport default PageNotFound;\n","import { FC, useState } from 'react';\nimport { Dropdown } from '../../components';\nimport { SelectOption } from '../Select';\nimport { FontAwesomeIcon as FAIcon } from '@fortawesome/react-fontawesome';\nimport classes from './NarrativeList.module.scss';\nimport { faCheck, faCaretDown } from '@fortawesome/free-solid-svg-icons';\n\ntype NarrativeItemDropdownProps = {\n  version: number;\n  onVersionSelect: (e: number) => void;\n};\nconst NarrativeItemDropdown: FC<NarrativeItemDropdownProps> = ({\n  version,\n  onVersionSelect,\n}) => {\n  const [selectedVersion, setSelectedVersion] = useState<number>(version);\n\n  const handleDropdownChange = (event: SelectOption[]) => {\n    setSelectedVersion(event[0].value as number);\n    onVersionSelect(event[0].value as number);\n  };\n\n  const versions = Array(version)\n    .fill(null)\n    .map((_, n) => n + 1)\n    .reverse()\n    .map((item) => {\n      return {\n        options: [\n          {\n            value: item,\n            icon: undefined,\n            label: (\n              <>\n                <span>{'v' + item}</span>\n                {item === selectedVersion && (\n                  <FAIcon icon={faCheck} style={{ marginLeft: '3rem' }} />\n                )}\n              </>\n            ),\n          },\n        ],\n      };\n    });\n\n  return (\n    <div className={classes.dropdown_wrapper}>\n      <Dropdown\n        className={classes.version_dropdown}\n        horizontalMenuAlign=\"right\"\n        options={versions}\n        onChange={(e) => handleDropdownChange(e)}\n      >\n        {selectedVersion === version ? (\n          <span>v{selectedVersion}</span>\n        ) : (\n          <span>\n            v{selectedVersion} of {version}\n          </span>\n        )}\n        <FAIcon icon={faCaretDown} style={{ marginLeft: '5px' }} />\n      </Dropdown>\n    </div>\n  );\n};\n\nexport default NarrativeItemDropdown;\n","import { NarrativeListDoc } from '../../types/NarrativeDoc';\nimport { FC, useEffect } from 'react';\nimport classes from './NarrativeList.module.scss';\nimport NarrativeItemDropdown from './NarrativeItemDropdown';\nimport * as timeago from 'timeago.js';\nexport interface NarrativeViewItemProps {\n  item: NarrativeListDoc;\n  idx: number;\n  active: boolean;\n  showVersionDropdown: boolean;\n  onSelectItem?: (idx: number) => void;\n  onUpaChange?: (upa: string) => void;\n}\n\nconst NarrativeViewItem: FC<NarrativeViewItemProps> = ({\n  showVersionDropdown,\n  onSelectItem,\n  onUpaChange,\n  active,\n  item,\n  idx,\n}) => {\n  const status = active ? 'active' : 'inactive';\n  const timeElapsed = timeago.format(item.timestamp);\n\n  // notify upa change once new narrative item is focused on\n  useEffect(() => {\n    if (active) {\n      const { access_group, obj_id, version } = item;\n      onUpaChange?.(`${access_group}/${obj_id}/${version}`);\n    }\n  }, [active, item, onUpaChange]);\n\n  function handleSelectItem(idx: number): void {\n    onSelectItem?.(idx);\n  }\n\n  function handleVersionSelect(version: number) {\n    const { access_group, obj_id } = item;\n    onUpaChange?.(`${access_group}/${obj_id}/${version}`);\n  }\n\n  return (\n    <section key={idx} onClick={() => handleSelectItem(idx)}>\n      <div className={`${classes.narrative_item_outer} ${classes[status]}`}>\n        <div className={classes.narrative_item_inner}>\n          <div className={classes.narrative_item_text}>\n            {item.narrative_title || 'Untitiled'}\n            {showVersionDropdown && active && (\n              <NarrativeItemDropdown\n                version={item.version}\n                onVersionSelect={(e) => handleVersionSelect(e)}\n              ></NarrativeItemDropdown>\n            )}\n          </div>\n          <div className={classes.narrative_item_details}>\n            Updated {timeElapsed} by {item.creator}\n          </div>\n        </div>\n      </div>\n    </section>\n  );\n};\n\nexport default NarrativeViewItem;\n","import { useState } from 'react';\nimport classes from './NarrativeList.module.scss';\nimport NarrativeViewItem from './NarrativeViewItem';\nimport { FontAwesomeIcon as FAIcon } from '@fortawesome/react-fontawesome';\nimport { faCog } from '@fortawesome/free-solid-svg-icons';\nimport { NarrativeListDoc } from '../../types/NarrativeDoc';\n\ninterface NarrativeListProps {\n  items: Array<NarrativeListDoc>;\n  showVersionDropdown: boolean;\n  itemsRemaining: number;\n  hasMoreItems: boolean;\n  loading: boolean;\n  onSelectItem?: (upa: string) => void;\n  onLoadMoreItems?: () => void;\n  selectedIdx?: number;\n  sort?: string; // do we need it\n}\n\nexport interface SelectItemEvent {\n  upa?: string;\n  idx: number;\n}\nfunction NarrativeList(props: NarrativeListProps) {\n  const [selectedIdx, setSelectedIdx] = useState<number>(\n    props.selectedIdx ?? -1\n  );\n\n  if (!props.items.length) {\n    if (props.loading) {\n      return (\n        <div className={classes.narrative_list_loading_outer}>\n          <div className={classes.narrative_list_loading_inner}>\n            <FAIcon\n              icon={faCog}\n              spin={true}\n              style={{ marginRight: '5px' }}\n            ></FAIcon>\n            Loading...\n          </div>\n        </div>\n      );\n    }\n    return (\n      <div className={classes.narrative_list_loading_outer}>\n        <p className={classes.narrative_list_loading_inner}>\n          No results found.\n        </p>\n      </div>\n    );\n  }\n\n  function hasMoreButton() {\n    const { itemsRemaining, hasMoreItems, loading, onLoadMoreItems } = props;\n    if (!hasMoreItems) {\n      return <span className={classes.list_footer}>No more results.</span>;\n    }\n    if (loading) {\n      return (\n        <span className={classes.list_footer}>\n          <FAIcon\n            icon={faCog}\n            spin={true}\n            style={{ marginRight: '5px' }}\n          ></FAIcon>\n          Loading...\n        </span>\n      );\n    }\n    return (\n      <span\n        className={`${classes.list_footer} ${classes.link_action}`}\n        onClick={onLoadMoreItems}\n      >\n        Load more ({itemsRemaining} remaining)\n      </span>\n    );\n  }\n\n  return (\n    <>\n      {props.items.map((item, idx) => {\n        return (\n          <NarrativeViewItem\n            key={idx}\n            item={item}\n            idx={idx}\n            active={idx === selectedIdx}\n            onSelectItem={(idx) => setSelectedIdx(idx)}\n            onUpaChange={(upa) => props.onSelectItem?.(upa)}\n            showVersionDropdown={props.showVersionDropdown}\n          ></NarrativeViewItem>\n        );\n      })}\n      {hasMoreButton()}\n    </>\n  );\n}\n\nexport default NarrativeList;\n","import { FC, useMemo } from 'react';\nimport { Link, useLocation, useParams } from 'react-router-dom';\nimport { Button } from '../../common/components';\nimport NarrativeList from '../../common/components/NarrativeList/NarrativeList';\nimport { useAppSelector } from '../../common/hooks';\nimport { usePageTitle } from '../layout/layoutSlice';\nimport { authUsername } from '../auth/authSlice';\nimport PageNotFound from '../layout/PageNotFound';\nimport classes from './Profile.module.scss';\nimport { getUserProfile } from '../../common/api/userProfileApi';\nimport { parseError } from '../../common/api/utils/parseError';\n\n/*\n * The following components are stubs due to be written in the future.\n * NarrativesView\n * ProfileInfobox\n * ProfileNarrativesMessage\n * ProfileResume\n * ProfileView\n */\n\nexport const ProfileNarrativesMessage: FC<{\n  realname: string;\n  yours: boolean;\n}> = ({ realname, yours }) => {\n  if (yours) {\n    return <span>This table shows all of your narratives.</span>;\n  }\n  return (\n    <span>\n      This table shows all narratives owned by {realname} which are also\n      accessible to you.\n    </span>\n  );\n};\n\nexport const ProfileResume: FC = () => {\n  return <div>Profile Resume</div>;\n};\n\nexport const NarrativesView: FC<{ realname: string; yours: boolean }> = ({\n  realname,\n  yours,\n}) => {\n  return (\n    <div className={classes.narratives}>\n      <ProfileNarrativesMessage realname={realname} yours={yours} />\n      <NarrativeList\n        items={[]}\n        itemsRemaining={0}\n        hasMoreItems={false}\n        loading={false}\n        showVersionDropdown\n      />\n    </div>\n  );\n};\n\nexport const ProfileInfobox: FC<{ realname: string }> = ({ realname }) => {\n  return <div>Profile Infobox for {realname}.</div>;\n};\n\nexport const ProfileView: FC<{ realname: string }> = ({ realname }) => {\n  return (\n    <div className={classes.profile}>\n      <ProfileInfobox realname={realname} />\n      <ProfileResume />\n    </div>\n  );\n};\n\nexport interface ProfileParams {\n  narrativesLink: string;\n  pageTitle: string;\n  profileLink: string;\n  realname: string;\n  username: string;\n  viewMine: boolean;\n  viewNarratives: boolean;\n}\n\nexport const Profile: FC<ProfileParams> = ({\n  narrativesLink,\n  pageTitle,\n  profileLink,\n  realname,\n  username,\n  viewMine,\n  viewNarratives,\n}) => {\n  usePageTitle(pageTitle);\n  return (\n    <>\n      <nav className={classes['profile-nav']}>\n        <ul className=\"links\">\n          <li>\n            <Link to={profileLink}>Profile</Link>\n          </li>\n          <li>\n            <Link to={narrativesLink}>Narratives</Link>\n          </li>\n        </ul>\n      </nav>\n      <section className={classes['profile-narratives']}>\n        {viewNarratives ? (\n          <NarrativesView realname={realname} yours={viewMine} />\n        ) : (\n          <ProfileView realname={realname} />\n        )}\n        <Button>Edit</Button>\n      </section>\n    </>\n  );\n};\n\nexport const ProfileWrapper: FC = () => {\n  const location = useLocation();\n  const { usernameRequested } = useParams<{ usernameRequested: string }>();\n\n  const usernameAuthed = useAppSelector(authUsername);\n\n  // Was a username specified in the URL?\n  const usernameNotSpecified =\n    usernameRequested === 'narratives' || usernameRequested === undefined;\n  // Am I looking at my own profile?\n  const viewMine = usernameRequested === usernameAuthed || usernameNotSpecified;\n  // In any case, whose profile should be shown?\n  const viewUsername =\n    usernameAuthed && usernameNotSpecified ? usernameAuthed : usernameRequested;\n\n  // Get the profile data\n  const profileQueryArgs = useMemo(\n    () => ({\n      usernames: [viewUsername || ''],\n    }),\n    [viewUsername]\n  );\n  const profileQuery = getUserProfile.useQuery(profileQueryArgs, {\n    refetchOnMountOrArgChange: true,\n    skip: !viewUsername,\n  });\n\n  const viewURL = location.pathname.split('/').slice(-1)[0];\n  const viewNarratives = viewURL === 'narratives';\n\n  if (profileQuery.isError) {\n    // eslint-disable-next-line no-console\n    console.error(`Error message: `, parseError(profileQuery?.error));\n  }\n\n  if (!usernameAuthed) {\n    /* If this component is loaded first (eg. a full page refresh) then the\n        authentication state will need to be populated before displaying the\n        profile for the current user.\n    */\n    return <>Loading authentication state.</>;\n  } else if (profileQuery.isLoading) {\n    return <>Loading user profile.</>;\n  } else if (\n    profileQuery.isSuccess &&\n    viewUsername &&\n    profileQuery.data[0][0] // is null when profile DNE\n  ) {\n    const profile = profileQuery.data[0][0];\n    const profileNames = profile.user;\n    const realname = profileNames.realname;\n    const whoseProfile = viewMine ? 'My ' : `${realname}'s `;\n    const pageTitle = realname ? `${whoseProfile} Profile` : '';\n    const profileLink = viewMine ? '/profile/' : `/profile/${viewUsername}`;\n    const narrativesLink = viewMine\n      ? '/profile/narratives'\n      : `/profile/${viewUsername}/narratives`;\n    return (\n      <Profile\n        narrativesLink={narrativesLink}\n        pageTitle={pageTitle}\n        profileLink={profileLink}\n        realname={realname}\n        username={viewUsername}\n        viewMine={viewMine}\n        viewNarratives={viewNarratives}\n      />\n    );\n  } else {\n    return <PageNotFound />;\n  }\n};\n\nexport default ProfileWrapper;\n","import { uriEncodeTemplateTag as encode } from '../utils/stringUtils';\nimport { baseApi } from './index';\nimport { httpService } from './utils/serviceHelpers';\n\nconst collectionsService = httpService({\n  url: 'services/collectionsservice',\n});\n\nexport interface DataProduct {\n  product: string;\n  version: string;\n  // unknown\n}\n\ninterface DataProductRef {\n  product: string;\n  version: string;\n}\n\nexport interface UnsavedCollection {\n  id: string;\n  name: string;\n  desc: string;\n  ver_tag: string;\n  ver_src: string;\n  icon_url: string;\n  data_products: DataProductRef[];\n}\n\nexport interface Collection extends UnsavedCollection {\n  ver_num: number;\n  user_create: string;\n  date_create: string;\n  user_active: string;\n  date_active: string;\n}\n\ninterface CollectionsResults {\n  status: {\n    service_name: string;\n    version: string;\n    git_hash: string;\n    server_time: string;\n  };\n  listCollections: { data: Collection[] };\n  getCollection: Collection;\n  saveCollection: Collection;\n  activateVersion: void;\n  listTaxaCountRanks: { data: string[] };\n  getTaxaCountRank: {\n    data: {\n      name: string;\n      count: number;\n    }[];\n  };\n}\n\ninterface CollectionsParams {\n  status: void;\n  listCollections: void;\n  getCollection: Collection['id'];\n  saveCollection: UnsavedCollection;\n  activateVersion:\n    | Pick<Collection, 'id' | 'ver_tag'>\n    | Pick<Collection, 'id' | 'ver_num'>;\n  listTaxaCountRanks: { collection_id: string; load_ver_override?: string };\n  getTaxaCountRank: {\n    collection_id: string;\n    rank: string;\n    load_ver_override?: string;\n  };\n}\n\n// Auth does not use JSONRpc, so we use queryFn to make custom queries\nexport const collectionsApi = baseApi.injectEndpoints({\n  endpoints: (builder) => ({\n    collectionsStatus: builder.query<\n      CollectionsResults['status'],\n      CollectionsParams['status']\n    >({\n      query: () => collectionsService({ method: 'GET', url: `/` }),\n    }),\n\n    listCollections: builder.query<\n      CollectionsResults['listCollections'],\n      CollectionsParams['listCollections']\n    >({\n      query: () => collectionsService({ method: 'GET', url: `/collections/` }),\n      // queryFn: () => ({\n      //   data: {\n      //     data: [\n      //       mockCollection(),\n      //       mockCollection(),\n      //       mockCollection(),\n      //       mockCollection(),\n      //       mockCollection(),\n      //     ],\n      //   },\n      // }),\n    }),\n\n    getCollection: builder.query<\n      CollectionsResults['getCollection'],\n      CollectionsParams['getCollection']\n    >({\n      query: (id) =>\n        collectionsService({ method: 'GET', url: encode`/collections/${id}/` }),\n      // queryFn: (id) => ({ data: mockCollection({ id }) }),\n    }),\n\n    saveCollection: builder.mutation<\n      CollectionsResults['saveCollection'],\n      CollectionsParams['saveCollection']\n    >({\n      query: ({ id, ver_tag, ...collection }) =>\n        collectionsService({\n          method: 'PUT',\n          url: encode`/collections/${id}/versions/${ver_tag}/`,\n        }),\n    }),\n\n    activateVersion: builder.mutation<\n      CollectionsResults['activateVersion'],\n      CollectionsParams['activateVersion']\n    >({\n      query: ({ id, ...either_ver }) =>\n        collectionsService({\n          method: 'PUT',\n          url:\n            'ver_num' in either_ver\n              ? encode`/collections/${id}/versions/num/${either_ver.ver_num}/activate/`\n              : encode`/collections/${id}/versions/tag/${either_ver.ver_tag}/activate/`,\n        }),\n    }),\n\n    listTaxaCountRanks: builder.query<\n      CollectionsResults['listTaxaCountRanks'],\n      CollectionsParams['listTaxaCountRanks']\n    >({\n      query: ({ collection_id, load_ver_override }) =>\n        collectionsService({\n          method: 'GET',\n          url: encode`/collections/${collection_id}/taxa_count/ranks/`,\n          params: load_ver_override ? { load_ver_override } : undefined,\n        }),\n    }),\n\n    getTaxaCountRank: builder.query<\n      CollectionsResults['getTaxaCountRank'],\n      CollectionsParams['getTaxaCountRank']\n    >({\n      query: ({ collection_id, rank, load_ver_override }) =>\n        collectionsService({\n          method: 'GET',\n          url: encode`/collections/${collection_id}/taxa_count/counts/${rank}/`,\n          params: load_ver_override ? { load_ver_override } : undefined,\n        }),\n    }),\n  }),\n});\nexport const {\n  collectionsStatus: status,\n  listCollections,\n  getCollection,\n  saveCollection,\n  activateVersion,\n  listTaxaCountRanks,\n  getTaxaCountRank,\n} = collectionsApi.endpoints;\n\n// const mockCollection = (override?: Partial<Collection>): Collection => {\n//   const randoNum = Math.floor(Math.random() * 1000000000);\n//   const id = Number(override?.id) || randoNum;\n//   return {\n//     id: String(id),\n//     name: `Some Collection with ID ${id}`,\n//     desc: 'some collections description here',\n//     ver_tag: `tag_${id}`,\n//     ver_num: id,\n//     ver_src: 'foo_bar_baz',\n//     icon_url: `https://picsum.photos/seed/${id}/64`,\n//     user_active: 'FooUser',\n//     user_create: 'FooUser2',\n//     date_create: new Date().toString(),\n//     date_active: new Date().toString(),\n//     data_products: [],\n//     ...override,\n//   };\n// };\n","import {\n  Children,\n  ComponentProps,\n  FC,\n  HTMLAttributes,\n  ReactElement,\n  useCallback,\n  useRef,\n} from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport classes from './Card.module.scss';\n\n/**\n * Component for rendering a data summary as a card.\n * Can behave as static (no onClick or linkTo), as an internal link (when linkTo\n * is defined), or as a button (when onClick is defined). Link behavior takes\n * precedence. A11y compatable (tab-selectable, enter/spacebar to simulate click)\n */\nexport const Card: FC<{\n  /** Title of the Card, may be a string or any react element */\n  title: string | ReactElement;\n  /** Subtitle of the Card, may be a string or any react element */\n  subtitle?: string | ReactElement;\n  /** Image for the card, any react element, but preferably and `<img>` */\n  image?: ReactElement;\n  /** When true, the card will appear selected */\n  selected?: boolean;\n  /** An internal link, when defined clicking the Card will navigate to the link */\n  linkTo?: string;\n  onClick?: (e: React.MouseEvent) => void;\n  className?: string;\n}> = ({ title, subtitle, image, onClick, linkTo, selected, className }) => {\n  const navigate = useNavigate();\n  const rootDiv = useRef<HTMLDivElement>(null);\n\n  const clickableRole = linkTo ? 'link' : onClick ? 'button' : undefined;\n  const handleClick: (e: React.MouseEvent) => void = useCallback(\n    (e: React.MouseEvent) => {\n      if (onClick) onClick(e);\n      if (linkTo) navigate(linkTo);\n    },\n    [linkTo, onClick, navigate]\n  );\n\n  let classNames: string = [\n    'card',\n    clickableRole ? 'clickable' : '',\n    selected ? 'selected' : '',\n  ]\n    .map((c) => classes[c])\n    .join(' ');\n\n  if (className) classNames += `${className}`;\n\n  const clickableProps: HTMLAttributes<HTMLDivElement> | undefined =\n    clickableRole\n      ? {\n          role: clickableRole,\n          tabIndex: 0,\n          'aria-pressed': selected,\n          onClick: handleClick,\n          /** For keyboard a11y */\n          onKeyDown: (ev, ...args) =>\n            [' ', 'Enter', 'Spacebar'].includes(ev.key) && handleClick\n              ? rootDiv?.current?.click()\n              : null,\n        }\n      : undefined;\n\n  return (\n    <div\n      className={classNames}\n      ref={rootDiv}\n      {...clickableProps}\n      data-testid=\"card\"\n    >\n      {image ? <div className={classes['image-wrapper']}>{image}</div> : null}\n      <div className={classes['body']}>\n        <div>{title}</div>\n        {subtitle ? (\n          <div className={classes['subtitle']}>{subtitle}</div>\n        ) : null}\n      </div>\n    </div>\n  );\n};\n\n/**\n * Simple wrapper component for rendering a list of cards.\n * @example ```tsx\n * <CardList>\n *   <Card {...}/>\n *   <Card {...}/>\n * <CardList/>\n * ```\n */\nexport const CardList: FC<ComponentProps<'ol'>> = ({ children, ...props }) => {\n  return (\n    <ol\n      {...props}\n      data-testid=\"cardList\"\n      className={props.className + ' ' + classes['card-list']}\n    >\n      {Children.map(children, (child) => (\n        <li>{child}</li>\n      ))}\n    </ol>\n  );\n};\n","import { FC, useMemo, useState } from 'react';\nimport {\n  getTaxaCountRank,\n  listTaxaCountRanks,\n} from '../../../common/api/collectionsApi';\nimport { Select, SelectOption } from '../../../common/components/Select';\nimport { snakeCaseToHumanReadable } from '../../../common/utils/stringUtils';\nimport classes from './TaxaCount.module.scss';\n\nexport const TaxaCount: FC<{\n  collection_id: string;\n}> = ({ collection_id }) => {\n  // Ranks\n  const ranksParams = useMemo(() => ({ collection_id }), [collection_id]);\n  const ranksQuery = listTaxaCountRanks.useQuery(ranksParams);\n  const [rank, setRank] = useState<SelectOption>();\n  const rankOptions: SelectOption[] = useMemo(() => {\n    const opts =\n      ranksQuery.data?.data.map((rank) => ({\n        value: rank,\n        label: snakeCaseToHumanReadable(rank),\n      })) || [];\n    setRank(opts?.[0]);\n    return opts;\n  }, [ranksQuery.data]);\n\n  // Counts\n  const countsParams = useMemo(\n    () => ({ collection_id, rank: String(rank?.value) }),\n    [collection_id, rank?.value]\n  );\n  const countsQuery = getTaxaCountRank.useQuery(countsParams, { skip: !rank });\n  const counts = countsQuery.data?.data || [];\n  const max = counts.reduce((max, { count }) => (max > count ? max : count), 0);\n\n  if (ranksQuery.isLoading || countsQuery.isLoading) return <>Loading...</>;\n\n  return (\n    <>\n      <Select\n        value={rank}\n        options={rankOptions}\n        onChange={(opt) => setRank(opt[0])}\n      />\n      <br></br>\n      <div className={classes['figure']}>\n        <div className={classes['name-section']}>\n          {counts.map(({ name }) => (\n            <div className={classes['name']}>{name}</div>\n          ))}\n        </div>\n        <div className={classes['bars-section']}>\n          {counts.map(({ count }) => {\n            const width = Math.round((count / max) * 10000) / 100;\n            return (\n              <div className={classes['bar-row']}>\n                <div\n                  className={classes['bar']}\n                  style={{\n                    width: `${width}%`,\n                  }}\n                >\n                  {width > 50 ? (\n                    <div className={classes['label-light']}>{count}</div>\n                  ) : null}\n                </div>\n                {width < 50 ? (\n                  <div className={classes['label-dark']}>{count}</div>\n                ) : null}\n              </div>\n            );\n          })}\n        </div>\n      </div>\n    </>\n  );\n};\n","import { FC } from 'react';\nimport { DataProduct as DataProductType } from '../../common/api/collectionsApi';\nimport { TaxaCount } from './data_products/TaxaCount';\n\nexport const DataProduct: FC<{\n  dataProduct: DataProductType;\n  collection_id: string;\n}> = ({ dataProduct, collection_id }) => {\n  if (dataProduct.product === 'taxa_count') {\n    return <TaxaCount {...{ collection_id }} />;\n  } else {\n    return <>'Invalid Data Product Type'</>;\n  }\n};\n","import { useParams } from 'react-router-dom';\nimport {\n  DataProduct as DataProductType,\n  getCollection,\n} from '../../common/api/collectionsApi';\nimport { usePageTitle } from '../layout/layoutSlice';\nimport styles from './Collections.module.scss';\nimport { Card, CardList } from '../../common/components/Card';\nimport { useEffect, useState } from 'react';\nimport { DataProduct } from './DataProduct';\nimport { snakeCaseToHumanReadable } from '../../common/utils/stringUtils';\n\nexport const CollectionDetail = () => {\n  const { id } = useParams();\n  const collectionQuery = getCollection.useQuery(id || '', {\n    skip: id === undefined,\n  });\n  const collection = collectionQuery.data;\n  usePageTitle(`Data Collections`);\n\n  // State for data_prodcut tabs\n  const [selectedDP, setSelectedDP] = useState<DataProductType>();\n  // Keep selectedDP up to date if collection reloads\n  useEffect(() => {\n    const matchingDP = collection?.data_products.find(\n      (dp) =>\n        dp.product === selectedDP?.product && dp.version === selectedDP?.version\n    );\n    if (matchingDP) {\n      setSelectedDP(matchingDP);\n    } else {\n      setSelectedDP(undefined);\n    }\n  }, [collection?.data_products, selectedDP]);\n\n  if (!collection) return <>loading...</>;\n  return (\n    <div className={styles['collection_wrapper']}>\n      <div className={styles['collection_detail']}>\n        <div className={styles['detail_header']}>\n          <img\n            src={collection.icon_url}\n            alt={`${collection.name} collection icon`}\n          />\n          <span>{collection.name}</span>\n        </div>\n\n        <p>Some text description of this collection</p>\n\n        <ul>\n          <li>\n            Version:{' '}\n            <strong>\n              v{collection.ver_num}: {collection.ver_tag}\n            </strong>\n          </li>\n        </ul>\n      </div>\n      <div className={styles['data_products']}>\n        <CardList className={styles['data_product_list']}>\n          {collection.data_products.map((dp) => (\n            <Card\n              key={dp.product + '|' + dp.version}\n              title={snakeCaseToHumanReadable(dp.product)}\n              subtitle={dp.version}\n              onClick={() => setSelectedDP(dp)}\n              selected={selectedDP === dp}\n            />\n          ))}\n        </CardList>\n        <div className={styles['data_product_detail']}>\n          {selectedDP ? (\n            <DataProduct\n              dataProduct={selectedDP}\n              collection_id={collection.id}\n            />\n          ) : (\n            <div className={styles['data_product_placeholder']}>\n              <span>Select a Data Product</span>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n","import { listCollections } from '../../common/api/collectionsApi';\nimport { usePageTitle } from '../layout/layoutSlice';\nimport { useNavigate } from 'react-router-dom';\nimport classes from './Collections.module.scss';\nimport { Card, CardList } from '../../common/components/Card';\n\nexport const CollectionsList = () => {\n  const navigate = useNavigate();\n  usePageTitle('Data Collections');\n  const collections = listCollections.useQuery();\n  return (\n    <div className={classes['collection_wrapper']}>\n      <div>\n        Some text explaining to users what they are looking at would go here.\n        Between this and the list below, we may add search/sort/etc inputs. We\n        may also add some sort of pagination at the bottom of the list.\n      </div>\n      <CardList>\n        {collections.isSuccess\n          ? collections.data?.data.map((collection) => {\n              const detailLink = encodeURIComponent(collection.id);\n              const handleClick = () => navigate(detailLink);\n              return (\n                <Card\n                  key={collection.id}\n                  title={collection.name}\n                  subtitle={collection.ver_tag}\n                  onClick={handleClick}\n                  image={\n                    <img\n                      src={collection.icon_url}\n                      alt={`${collection.name} collection icon`}\n                    />\n                  }\n                />\n              );\n            })\n          : null}\n      </CardList>\n    </div>\n  );\n};\n","import { Route, Routes } from 'react-router-dom';\nimport { CollectionDetail } from './CollectionDetail';\nimport { CollectionsList } from './CollectionsList';\n\nexport default function Collections() {\n  return (\n    <Routes>\n      <Route path=\"/\" element={<CollectionsList />} />\n      <Route path=\"/:id\" element={<CollectionDetail />} />\n      <Route path=\"*\" element={<span>hmmm</span>} />\n    </Routes>\n  );\n}\n","import { FC, ReactElement } from 'react';\nimport {\n  Navigate,\n  Route,\n  Routes as RRRoutes,\n  useLocation,\n} from 'react-router-dom';\n\nimport Auth from '../features/auth/Auth';\nimport Count from '../features/count/Counter';\nimport Legacy, { LEGACY_BASE_ROUTE } from '../features/legacy/Legacy';\nimport Navigator from '../features/navigator/Navigator';\nimport PageNotFound from '../features/layout/PageNotFound';\nimport ProfileWrapper from '../features/profile/Profile';\nimport Collections from '../features/collections/Collections';\nimport { useAppSelector } from '../common/hooks';\n\nexport const LOGIN_ROUTE = '/legacy/login';\nexport const ROOT_REDIRECT_ROUTE = '/narratives';\n\nconst Routes: FC = () => (\n  <>\n    <RRRoutes>\n      <Route path={`${LEGACY_BASE_ROUTE}/*`} element={<Legacy />} />\n      <Route\n        path=\"/profile/:usernameRequested/narratives\"\n        element={<Authed element={<ProfileWrapper />} />}\n      />\n      <Route\n        path=\"/profile/:usernameRequested\"\n        element={<Authed element={<ProfileWrapper />} />}\n      />\n      <Route\n        path=\"/profile\"\n        element={<Authed element={<ProfileWrapper />} />}\n      />\n      <Route path=\"/count\" element={<Authed element={<Count />} />} />\n      <Route path=\"/auth\" element={<Auth />} />\n      <Route\n        path={'/narratives/:id/:obj/:ver'}\n        element={<Authed element={<Navigator />} />}\n      />\n      <Route\n        path={'/narratives/:category'}\n        element={<Authed element={<Navigator />} />}\n      />\n      <Route\n        path={'/narratives/:category/:id/:obj/:ver'}\n        element={<Navigator />}\n      />\n      <Route path=\"/narratives\" element={<Authed element={<Navigator />} />} />\n      <Route path=\"/collections/*\" element={<Collections />} />\n      <Route path=\"/\" element={<HashRouteRedirect />} />\n      <Route path=\"*\" element={<PageNotFound />} />\n    </RRRoutes>\n  </>\n);\n\nexport const Authed: FC<{ element: ReactElement }> = ({ element }) => {\n  const token = useAppSelector((state) => state.auth.token);\n  const location = useLocation();\n  if (!token)\n    return (\n      <Navigate\n        to={LOGIN_ROUTE}\n        replace\n        state={{ preLoginPath: location.pathname }}\n      />\n    );\n\n  return <>{element}</>;\n};\n\nexport const HashRouteRedirect = () => {\n  const location = useLocation();\n  if (location.hash)\n    return (\n      <Navigate to={`${LEGACY_BASE_ROUTE}/${location.hash.slice(1)}`} replace />\n    );\n  return <Navigate to={ROOT_REDIRECT_ROUTE} replace />;\n};\n\nexport default Routes;\n","import { FC } from 'react';\nimport { Link, useLocation } from 'react-router-dom';\nimport classes from './LeftNavBar.module.scss';\nimport { FontAwesomeIcon as FAIcon } from '@fortawesome/react-fontawesome';\nimport {\n  faExclamation,\n  faCompass,\n  faUsers,\n  faBook,\n  faSearch,\n  faSuitcase,\n  faIdCard,\n  faBullhorn,\n  IconDefinition,\n  faBoxesStacked,\n} from '@fortawesome/free-solid-svg-icons';\n\nexport default function LeftNavBar() {\n  return (\n    <nav>\n      <ul className={classes.nav_list}>\n        <NavItem path=\"/\" desc=\"Navigator\" icon={faCompass} />\n        <NavItem path=\"/legacy/orgs\" desc=\"Orgs\" icon={faUsers} />\n        <NavItem path=\"/legacy/catalog/apps\" desc=\"Catalog\" icon={faBook} />\n        <NavItem path=\"/legacy/search\" desc=\"Search\" icon={faSearch} />\n        <NavItem path=\"/legacy/jobbrowser\" desc=\"Jobs\" icon={faSuitcase} />\n        <NavItem path=\"/legacy/account\" desc=\"Account\" icon={faIdCard} />\n        <NavItem path=\"/legacy/feeds\" desc=\"Feeds\" icon={faBullhorn} />\n        <NavItem path=\"/count\" desc=\"Count\" icon={faExclamation} />\n        <NavItem path=\"/auth\" desc=\"Auth\" icon={faExclamation} />\n        <NavItem path=\"/collections\" desc=\"Collections\" icon={faBoxesStacked} />\n      </ul>\n    </nav>\n  );\n}\n\nconst NavItem: FC<{ path: string; desc: string; icon: IconDefinition }> = ({\n  path,\n  desc,\n  icon,\n}) => {\n  const location = useLocation();\n  let itemClasses = classes.nav_item;\n  if (location.pathname === path) {\n    itemClasses += ` ${classes.active}`;\n  }\n  return (\n    <li className={itemClasses} key={path}>\n      <Link to={path}>\n        <FAIcon className={classes.nav_icon} icon={icon} />\n        <span className={classes.nav_desc}>{desc}</span>\n      </Link>\n    </li>\n  );\n};\n","export default \"data:image/png;base64,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\"","import { FontAwesomeIcon as FAIcon } from '@fortawesome/react-fontawesome';\nimport {\n  faBars,\n  faEnvelope,\n  faFile,\n  faFlask,\n  faIdCard,\n  faInfo,\n  faPlus,\n  faQuestion,\n  faQuestionCircle,\n  faSearch,\n  faServer,\n  faSignOutAlt,\n  faSortDown,\n  faSquare,\n  faUser,\n  faWrench,\n} from '@fortawesome/free-solid-svg-icons';\nimport { FC } from 'react';\nimport { useNavigate } from 'react-router-dom';\n\nimport logo from '../../common/assets/logo/46_square.png';\nimport { Dropdown } from '../../common/components';\nimport { useAppSelector } from '../../common/hooks';\nimport { authUsername } from '../auth/authSlice';\nimport { profileRealname } from '../profile/profileSlice';\nimport classes from './TopBar.module.scss';\n\nexport default function TopBar() {\n  return (\n    <header className={classes.topbar}>\n      <div className={classes.topbar_item}>\n        <HamburgerMenu />\n      </div>\n      <div className={classes.topbar_item}>\n        <img src={logo} alt=\"\" />\n      </div>\n      <div className={[classes.topbar_item, classes.stretch].join(' ')}>\n        <PageTitle />\n      </div>\n      <div className={classes.topbar_item}>\n        <Enviroment />\n      </div>\n      <div className={classes.topbar_item}>\n        <LoginMenu />\n      </div>\n    </header>\n  );\n}\n\nconst LoginMenu: FC = () => {\n  const username = useAppSelector(authUsername);\n  const realname = useAppSelector(profileRealname);\n  const navigate = useNavigate();\n  return (\n    <div className={classes.login_menu}>\n      <Dropdown\n        horizontalMenuAlign=\"right\"\n        options={[\n          {\n            options: [\n              {\n                value: '',\n                icon: undefined,\n                label: (\n                  <div>\n                    <div>{realname}</div>\n                    <div className={classes.login_menu_username}>\n                      {username}\n                    </div>\n                  </div>\n                ),\n              },\n            ],\n          },\n          {\n            options: [\n              {\n                value: '/profile',\n                icon: <FAIcon icon={faUser} />,\n                label: 'Your Profile',\n              },\n              {\n                value: '#your_account',\n                icon: <FAIcon icon={faIdCard} />,\n                label: 'Your Account',\n              },\n            ],\n          },\n          {\n            options: [\n              {\n                value: '#sign_out',\n                icon: <FAIcon icon={faSignOutAlt} />,\n                label: 'Sign Out',\n              },\n            ],\n          },\n        ]}\n        onChange={(opt) => {\n          if (opt?.[0]) navigate(opt[0].value as string);\n        }}\n      >\n        <div className={classes.login_menu_button}>\n          <FAIcon className={classes.login_menu_icon} icon={faSquare} />\n          <FAIcon icon={faSortDown} />\n        </div>\n      </Dropdown>\n    </div>\n  );\n};\n\nconst HamburgerMenu: FC = () => {\n  return (\n    <div className={classes.hamburger_menu}>\n      <Dropdown\n        options={[\n          {\n            options: [\n              {\n                value: window.location.origin + '/#narrativemanager/start',\n                icon: <FAIcon icon={faFile} />,\n                label: 'Narrative Interface',\n              },\n              {\n                value: window.location.origin + '/#narrativemanager/new',\n                icon: <FAIcon icon={faPlus} />,\n                label: 'New Narrative',\n              },\n              {\n                value: window.location.origin + '/#jgi-search',\n                icon: <FAIcon icon={faSearch} />,\n                label: 'JGI Search',\n              },\n              {\n                value: window.location.origin + '/#biochem-search',\n                icon: <FAIcon icon={faSearch} />,\n                label: 'Biochem Search',\n              },\n            ],\n          },\n          {\n            options: [\n              {\n                value: window.location.origin + '/#about/services',\n                icon: <FAIcon icon={faServer} />,\n                label: 'KBase Services Status',\n              },\n            ],\n          },\n          {\n            options: [\n              {\n                value: window.location.origin + '/#about',\n                icon: <FAIcon icon={faInfo} />,\n                label: 'About',\n              },\n              {\n                value: 'https://kbase.us/contact-us',\n                icon: <FAIcon icon={faEnvelope} />,\n                label: 'Contact KBase',\n              },\n              {\n                value: 'https://kbase.us/narrative-guide/',\n                icon: <FAIcon icon={faQuestion} />,\n                label: 'Support',\n              },\n            ],\n          },\n        ]}\n        onChange={(opt) => {\n          if (opt?.[0]) window.location.href = opt[0].value as string;\n        }}\n      >\n        <FAIcon className={classes.hamburger_menu_icon} icon={faBars} />\n      </Dropdown>\n    </div>\n  );\n};\n\nconst PageTitle: FC = () => {\n  const title = useAppSelector((state) => state.layout.pageTitle);\n  return (\n    <div className={classes.page_title}>\n      <span>{title || ''}</span>\n    </div>\n  );\n};\n\nconst Enviroment: FC = () => {\n  const env = useAppSelector((state) => state.layout.environment);\n  if (env === 'production') return null;\n  const icon = {\n    ci: faFlask,\n    'ci-europa': faFlask,\n    unknown: faQuestionCircle,\n    appdev: faWrench,\n  }[env];\n  const txt = {\n    ci: 'CI',\n    'ci-europa': 'EUR',\n    unknown: '??',\n    appdev: 'APPDEV',\n  }[env];\n  return (\n    <div className={classes.environment}>\n      <span>{txt}</span>\n      <FAIcon icon={icon} />\n    </div>\n  );\n};\n","import { usePageTitle } from './layoutSlice';\n\nexport default function ErrorPage({\n  error,\n  resetErrorBoundary,\n}: {\n  error: {};\n  resetErrorBoundary: () => void;\n}) {\n  usePageTitle('Something went wrong');\n  return (\n    <div role=\"alert\">\n      <pre>\n        {error instanceof Error ? error.toString() : JSON.stringify(error)}\n      </pre>\n      <button onClick={resetErrorBoundary}>Try again</button>\n    </div>\n  );\n}\n","import classes from './App.module.scss';\n\nimport { BrowserRouter as Router } from 'react-router-dom';\nimport { useAppDispatch, useAppSelector } from '../common/hooks';\nimport { useEffect } from 'react';\nimport { setEnvironment } from '../features/layout/layoutSlice';\nimport {\n  authInitialized,\n  authUsername,\n  useTokenCookie,\n} from '../features/auth/authSlice';\nimport { useLoggedInProfileUser } from '../features/profile/profileSlice';\nimport { ErrorBoundary } from 'react-error-boundary';\n\nimport Routes from './Routes';\nimport LeftNavBar from '../features/layout/LeftNavBar';\nimport TopBar from '../features/layout/TopBar';\nimport ErrorPage from '../features/layout/ErrorPage';\n\nconst useInitApp = () => {\n  const dispatch = useAppDispatch();\n\n  // Pulls token from cookie, syncs cookie to auth state\n  useTokenCookie('kbase_session');\n\n  // Use authenticated username to load user's profile\n  const username = useAppSelector(authUsername);\n  const initialized = useAppSelector(authInitialized);\n  useLoggedInProfileUser(username);\n\n  // Placeholder code for determining environment.\n  useEffect(() => {\n    dispatch(setEnvironment('ci-europa'));\n  }, [dispatch]);\n\n  return { isLoading: !initialized };\n};\n\nexport default function App() {\n  const { isLoading } = useInitApp();\n\n  return (\n    <Router basename={process.env.PUBLIC_URL}>\n      <div className={classes.container}>\n        <div className={classes.topbar}>\n          <TopBar />\n        </div>\n        <div className={classes.site_content}>\n          <div className={classes.left_navbar}>\n            <LeftNavBar />\n          </div>\n          <div className={classes.page_content}>\n            <ErrorBoundary FallbackComponent={ErrorPage}>\n              {isLoading ? 'Loading...' : <Routes />}\n            </ErrorBoundary>\n          </div>\n        </div>\n      </div>\n    </Router>\n  );\n}\n","import {\n  faAlignJustify,\n  faTable,\n  faListUl,\n  faSliders,\n  faChartArea,\n  faTableCells,\n  faTableList,\n  faFlask,\n  faCodeFork,\n  faBullseye,\n  faArrowsLeftRight,\n  faGaugeHigh,\n  faBook,\n  IconDefinition,\n} from '@fortawesome/free-solid-svg-icons';\n\nexport interface IconInfo {\n  /*\n    if IconInfo.icon is a string, it will either be the img src url\n    or the kbase css class name, depending on whether its used in an\n    AppCellIcon or a TypeIcon.\n  */\n  icon: string | IconDefinition;\n  color: string;\n}\n\nexport function isFAIcon(\n  icon: string | IconDefinition\n): icon is IconDefinition {\n  return (icon as IconDefinition).icon !== undefined;\n}\n\nexport const typeIconInfos = {\n  assemblyinput: {\n    color: '#F44336',\n    icon: 'icon icon-reads',\n  },\n  assembly: {\n    color: '#920D58',\n    icon: faAlignJustify,\n  },\n  chromatographymatrix: {\n    color: '#E91E63',\n    icon: faTable,\n  },\n  collection: {\n    color: '#E91E63',\n    icon: faListUl,\n  },\n  contigset: {\n    color: '#3F51B5',\n    icon: faAlignJustify,\n  },\n  domainalignment: {\n    color: '#000000',\n    icon: faSliders,\n  },\n  estimatekresult: {\n    color: '#000000',\n    icon: faChartArea,\n  },\n  expressionmatrix: {\n    color: '#2196F3',\n    icon: faTableCells,\n  },\n  expressionsample: {\n    color: '#2196F3',\n    icon: faGaugeHigh,\n  },\n  expressionseries: {\n    color: '#2196F3',\n    icon: faGaugeHigh,\n  },\n  fba: {\n    color: '#673AB7',\n    icon: 'icon icon-metabolism',\n  },\n  fbamodel: {\n    color: '#673AB7',\n    icon: 'icon icon-metabolism',\n  },\n  featureclusters: {\n    color: '#AEEA00',\n    icon: faTableList,\n  },\n  featureset: {\n    color: '#AEEA00',\n    icon: faListUl,\n  },\n  functionalmatrix: {\n    color: '#000000',\n    icon: faTable,\n  },\n  genome: {\n    color: '#3F51B5',\n    icon: 'icon icon-genome',\n  },\n  genomeannotation: {\n    color: '#920D58',\n    icon: 'icon icon-genome',\n  },\n  genomecomparison: {\n    color: '#3F51B5',\n    icon: 'icon icon-compare',\n  },\n  genomeset: {\n    color: '#3F51B5',\n    icon: faListUl,\n  },\n  heatmap: {\n    color: '#795548',\n    icon: faTableCells,\n  },\n  media: {\n    color: '#795548',\n    icon: faFlask,\n  },\n  metagenome: {\n    color: '#795548',\n    icon: 'icon icon-metagenome',\n  },\n  network: {\n    color: '#795548',\n    icon: faCodeFork,\n  },\n  pairedendlibrary: {\n    color: '#795548',\n    icon: 'icon icon-reads',\n  },\n  pangenome: {\n    color: '#795548',\n    icon: faBullseye,\n  },\n  phenotypeset: {\n    color: '#795548',\n    icon: faListUl,\n  },\n  phenotypesimulationset: {\n    color: '#795548',\n    icon: faListUl,\n  },\n  proteomecomparison: {\n    color: '#795548',\n    icon: faArrowsLeftRight,\n  },\n  readsset: {\n    color: '#795548',\n    icon: 'icon icon-reads',\n  },\n  referenceassembly: {\n    color: '#795548',\n    icon: faBook,\n  },\n  singleendlibrary: {\n    color: '#795548',\n    icon: 'icon icon-reads',\n  },\n  taxonomicmatrix: {\n    color: '#795548',\n    icon: faTable,\n  },\n  taxon: {\n    color: '#920D58',\n    icon: faTable,\n  },\n  tree: {\n    color: '#795548',\n    icon: 'icon icon-tree',\n  },\n};\n","import { baseApi } from './index';\nimport { jsonRpcService } from './utils/serviceHelpers';\n\nexport const narrativeMethodStore = jsonRpcService({\n  url: '/services/narrative_method_store/rpc',\n});\n\ninterface NarrativeMethodStoreParams {\n  status: void;\n  getMethodBriefInfo: {\n    ids: readonly string[];\n    tag: 'release' | 'dev' | 'beta';\n  }[];\n}\n\ninterface NarrativeMethodStoreResults {\n  status: unknown;\n  getMethodBriefInfo: {\n    id: string;\n    module_name: string;\n    git_commit_hash: string;\n    name: string;\n    ver: string;\n    subtitle: string;\n    tooltip: string;\n    icon: { url: string };\n    categories: string[];\n    loading_error: string;\n    authors: string[];\n    input_types: string[];\n    output_types: string[];\n    app_type: string;\n  }[];\n}\n\nconst narrativeMethodStoreApi = baseApi.injectEndpoints({\n  endpoints: (builder) => ({\n    narrativeMethodStoreStatus: builder.query<\n      NarrativeMethodStoreResults['status'],\n      NarrativeMethodStoreParams['status']\n    >({\n      query: () =>\n        narrativeMethodStore({\n          method: 'NarrativeMethodStore.status',\n          params: [],\n        }),\n    }),\n    getMethodBriefInfo: builder.query<\n      NarrativeMethodStoreResults['getMethodBriefInfo'],\n      NarrativeMethodStoreParams['getMethodBriefInfo']\n    >({\n      query: (params) =>\n        narrativeMethodStore({\n          method: 'NarrativeMethodStore.get_method_brief_info',\n          params: params,\n        }),\n    }),\n  }),\n});\n\nexport const { narrativeMethodStoreStatus, getMethodBriefInfo } =\n  narrativeMethodStoreApi.endpoints;\n","import { createSlice } from '@reduxjs/toolkit';\nimport { IconInfo, typeIconInfos } from './common';\nimport { faCube, faFile, faSpinner } from '@fortawesome/free-solid-svg-icons';\nimport { getMethodBriefInfo } from '../../common/api/narrativeMethodStore';\nimport { useMemo } from 'react';\nimport { useAppSelector } from '../../common/hooks';\n\nexport enum AppTag {\n  release = 'release',\n  beta = 'beta',\n  dev = 'dev',\n}\n\nconst isAppTag = (appTag: string): appTag is AppTag => {\n  return appTag in AppTag;\n};\n\ntype AppIconCache = { [appTag in AppTag]: { [appId: string]: IconInfo } };\n\ninterface IconState {\n  typeIconInfos: { [key: string]: IconInfo };\n  appIconCache: AppIconCache;\n  defaultApp: IconInfo;\n  defaultType: IconInfo;\n  loadingIcon: IconInfo;\n}\n\nconst initialState: IconState = {\n  appIconCache: {\n    release: {},\n    beta: {},\n    dev: {},\n  },\n  typeIconInfos,\n  defaultApp: {\n    icon: faCube,\n    color: '#683AB7',\n  },\n  defaultType: {\n    icon: faFile,\n    color: '#F44336',\n  },\n  loadingIcon: {\n    icon: faSpinner,\n    color: 'silver',\n  },\n};\n\nexport const iconSlice = createSlice({\n  name: 'icons',\n  initialState,\n  reducers: {},\n  extraReducers: (builder) =>\n    builder.addMatcher(\n      getMethodBriefInfo.matchFulfilled,\n      (state, { payload, meta }) => {\n        // Update Icon Cache when getMethodBriefInfo succeeds\n        const appIds = meta.arg.originalArgs[0].ids;\n        const appTags = meta.arg.originalArgs[0].ids;\n        for (let i = 0; i < appIds.length; i++) {\n          const appId = appIds[i];\n          const appTag = appTags[i];\n          const iconPath = payload[i]?.icon?.url;\n          if (appId && iconPath && isAppTag(appTag)) {\n            state.appIconCache[appTag][appId] = {\n              icon: `/services/narrative_method_store/${iconPath}`,\n              color: 'silver',\n            };\n          }\n        }\n      }\n    ),\n});\n\nexport default iconSlice.reducer;\n//export const {} = iconSlice.actions;\n\nexport const useAppIcon = ({\n  appId,\n  appTag,\n}: {\n  appId: string;\n  appTag: AppTag;\n}): IconInfo => {\n  // Get the default, loading, and cached icons\n  const defaultIcon = useAppSelector(({ icons }) => icons.defaultApp);\n  const loadingIcon = useAppSelector(({ icons }) => icons.loadingIcon);\n  const cachedIcon = useAppSelector(\n    ({ icons }) => icons.appIconCache[appTag][appId]\n  );\n\n  // If there isn't a cached icon, update the cache by calling getMethodBriefInfo\n  const getMethodBriefInfoParams = useMemo(() => {\n    return [{ ids: [appId], tag: appTag }];\n  }, [appId, appTag]);\n  const { isLoading } = getMethodBriefInfo.useQuery(getMethodBriefInfoParams, {\n    skip: !!cachedIcon,\n  });\n\n  if (cachedIcon) return cachedIcon;\n  if (isLoading) return loadingIcon;\n  return defaultIcon;\n};\n","import { configureStore } from '@reduxjs/toolkit';\nimport { baseApi } from '../common/api';\nimport auth from '../features/auth/authSlice';\nimport count from '../features/count/countSlice';\nimport icons from '../features/icons/iconSlice';\nimport layout from '../features/layout/layoutSlice';\nimport profile from '../features/profile/profileSlice';\n\nconst createStore = <T>(additionalOptions?: T) => {\n  return configureStore({\n    devTools: true,\n    reducer: {\n      auth,\n      count,\n      icons,\n      layout,\n      profile,\n      [baseApi.reducerPath]: baseApi.reducer,\n    },\n    middleware: (getDefaultMiddleware) =>\n      getDefaultMiddleware().concat(baseApi.middleware),\n    ...additionalOptions,\n  });\n};\n\nexport const store = createStore();\n\n// Infer the `RootState` and `AppDispatch` types from the store itself\nexport type RootState = ReturnType<typeof store.getState>;\nexport type AppDispatch = typeof store.dispatch;\n\nexport const createTestStore = (preloadedState: Partial<RootState> = {}) => {\n  return createStore({ preloadedState: preloadedState });\n};\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Provider } from 'react-redux';\nimport './index.scss';\nimport App from './app/App';\nimport { store } from './app/store';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <App />\n    </Provider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}